<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Describing a nitrogen budget | A Primer of Ecosystem Modeling - a work in progress</title>
  <meta name="description" content="This provides a part of foundation in understanding ecosystem models." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Describing a nitrogen budget | A Primer of Ecosystem Modeling - a work in progress" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This provides a part of foundation in understanding ecosystem models." />
  <meta name="github-repo" content="HankStevens/ecosystems-primer" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Describing a nitrogen budget | A Primer of Ecosystem Modeling - a work in progress" />
  
  <meta name="twitter:description" content="This provides a part of foundation in understanding ecosystem models." />
  

<meta name="author" content="Hank Stevens, BIO 672" />


<meta name="date" content="2021-01-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="lake-metabolism.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#must-dos"><i class="fa fa-check"></i><b>1.1</b> Must do’s</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#a-couple-of-useful-citations"><i class="fa fa-check"></i><b>1.2</b> A couple of useful citations</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction ecosystem models</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#why-models"><i class="fa fa-check"></i><b>2.1</b> Why models?</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#whats-an-ecosystem"><i class="fa fa-check"></i><b>2.2</b> What’s an ecosystem?</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#whats-a-model"><i class="fa fa-check"></i><b>2.3</b> What’s a model?</a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#other-ideas"><i class="fa fa-check"></i><b>2.3.1</b> Other ideas</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#steps-in-modeling"><i class="fa fa-check"></i><b>2.4</b> Steps in modeling</a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#an-example-in-r"><i class="fa fa-check"></i><b>2.5</b> An example in R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="N.html"><a href="N.html"><i class="fa fa-check"></i><b>3</b> Describing a nitrogen budget</a><ul>
<li class="chapter" data-level="3.1" data-path="N.html"><a href="N.html#getting-started"><i class="fa fa-check"></i><b>3.1</b> Getting started</a></li>
<li class="chapter" data-level="3.2" data-path="N.html"><a href="N.html#first-mathematical-form-for-plant-uptake"><i class="fa fa-check"></i><b>3.2</b> First mathematical form for plant uptake</a></li>
<li class="chapter" data-level="3.3" data-path="N.html"><a href="N.html#paramaterization"><i class="fa fa-check"></i><b>3.3</b> Paramaterization</a></li>
<li class="chapter" data-level="3.4" data-path="N.html"><a href="N.html#mathematical-solution"><i class="fa fa-check"></i><b>3.4</b> Mathematical solution</a></li>
<li class="chapter" data-level="3.5" data-path="N.html"><a href="N.html#calibration-take-1"><i class="fa fa-check"></i><b>3.5</b> Calibration, take 1</a></li>
<li class="chapter" data-level="3.6" data-path="N.html"><a href="N.html#budget-take-ii"><i class="fa fa-check"></i><b>3.6</b> Budget, take II</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lake-metabolism.html"><a href="lake-metabolism.html"><i class="fa fa-check"></i><b>4</b> Lake Metabolism</a><ul>
<li class="chapter" data-level="4.1" data-path="lake-metabolism.html"><a href="lake-metabolism.html#estimating-productivity"><i class="fa fa-check"></i><b>4.1</b> Estimating Productivity</a></li>
<li class="chapter" data-level="4.2" data-path="lake-metabolism.html"><a href="lake-metabolism.html#by-hand-in-r"><i class="fa fa-check"></i><b>4.2</b> By hand, in R</a></li>
<li class="chapter" data-level="4.3" data-path="lake-metabolism.html"><a href="lake-metabolism.html#the-lakemetabolizer-package"><i class="fa fa-check"></i><b>4.3</b> the LakeMetabolizer package</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="MEL.html"><a href="MEL.html"><i class="fa fa-check"></i><b>5</b> Multiple Element Limitation</a><ul>
<li class="chapter" data-level="5.1" data-path="MEL.html"><a href="MEL.html#rastetter-et-al.-1997"><i class="fa fa-check"></i><b>5.1</b> Rastetter et al. 1997</a></li>
<li class="chapter" data-level="5.2" data-path="MEL.html"><a href="MEL.html#implementing-mel"><i class="fa fa-check"></i><b>5.2</b> Implementing MEL</a><ul>
<li class="chapter" data-level="5.2.1" data-path="MEL.html"><a href="MEL.html#increasing-atmospheric-carbon-with-events-in-ode"><i class="fa fa-check"></i><b>5.2.1</b> Increasing atmospheric carbon with events in <code>ode()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>6</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Primer of Ecosystem Modeling - a work in progress</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="N" class="section level1">
<h1><span class="header-section-number">3</span> Describing a nitrogen budget</h1>
<p>Readings:</p>
<ul>
<li>pp. 17-35 (Soetaert and Hermann 2009)</li>
<li>Bormann et al. 1977</li>
</ul>
<div class="figure"><span id="fig:hbnb"></span>
<img src="figs/BormannF2.png" alt="*Nitrogen bugdget for a temperate northern hardwood forest (Hubbard Brook Watershed 6, Bormann et al. 1977).*" width="100%" />
<p class="caption">
Figure 3.1: <em>Nitrogen bugdget for a temperate northern hardwood forest (Hubbard Brook Watershed 6, Bormann et al. 1977).</em>
</p>
</div>
<div class="figure"><span id="fig:hbnb3"></span>
<img src="figs/model3.png" alt="*A simpler compartment model for Hubbard Brook Watershed 6, based on Bormann et al. (1977).*" width="66%" />
<p class="caption">
Figure 3.2: <em>A simpler compartment model for Hubbard Brook Watershed 6, based on Bormann et al. (1977).</em>
</p>
</div>
<div id="getting-started" class="section level2">
<h2><span class="header-section-number">3.1</span> Getting started</h2>
<ol style="list-style-type: decimal">
<li><p>(S&amp;H 15-17) For any ecosystem, we want to start with paper and pencil and <strong>sketch out the pools and the fluxes</strong> that we think are important (see example, Fig. <a href="N.html#fig:hbnb3">3.2</a>). Don’t sweat the details yet – you’ll revise it anyway. Go ahead an label the compartments and the fluxes with with both biological and physical processes as well as some simple abstract notation.</p></li>
<li><p><strong>Write balance equations</strong> (S&amp;H, 3, 17-20). For each flux, identify the underlying biological and physical processes. If you don’t completely know, don’t sweat it. Here are the balance equations for Fig. <a href="N.html#fig:hbnb3">3.2</a>:</p></li>
</ol>
<p>Rate of change of vegetation = uptake - exudates and through fall - leaf and root litter loss
<span class="math display">\[\frac{dV}{dt} = f_1 - f_2 - f_3\]</span></p>
<p>Rate of change in available pool in soil solution = bulk precip + exudates and through fall + net mineralization - uptake - stream export
<span class="math display">\[\frac{dA}{dt} = I_1 + f_2 + f_4 - f_1 - E_1\]</span></p>
<p>Rate of change in the bound pool = net N fixation + leaf and root litter loss - net mineralization - stream export
<span class="math display">\[\frac{dB}{dt} = I_2 + f_3 - f_4 - E_2\]</span></p>
<ol start="3" style="list-style-type: decimal">
<li>Assess the total load or mass budget (S&amp;H, 19-22). For Fig. <a href="N.html#fig:hbnb3">3.2</a>, we have
<span class="math display">\[\frac{d\left(V+A+B\right)}{dt} = \frac{dV}{dt} + \frac{dA}{dt} + \frac{dB}{dt} = (f_1 - f_2 - f_3) + (I_1 + f_2 + f_4 - f_1 - E_1) + (I_2 + f_3 - f_4 - E_2)\]</span>
<span class="math display">\[\frac{d\left(V+A+B\right)}{dt} = I_1 + I_2 + f_1 - f_1 + f_2 - f_2 + f_3 - f_3  + f_4 - f_4 - E_1 - E_2\]</span></li>
</ol>
<p><span class="math display">\[\frac{d\left(V+A+B\right)}{dt} = I_1 + I_2 - E_1 - E_2\]</span>
From this we see that the total mass budget for this watershed depends simply on import or inputs, and exports or outputs.</p>
<ol start="3" style="list-style-type: decimal">
<li>For each flux, <strong>decide which pools directly influence the flux</strong>. In a forest, the flux of nitrogen from vegetation to soil will depend enormously on the amount of vegetation present as leaves senesce and fall, fine roots die back, and water leaches nutrients out of leaves and bark. The flux is very unlikely to depend directly on the amount of nitrogen already in the soil. In a lake, the flux of phosphorous from the water column into phytoplankton depends on the amounts of both the amount of phytoplankton and the amount of phosphate in the water at any given instant.</li>
</ol>
<p>For the vegetation pool in Fig. <a href="N.html#fig:hbnb3">3.2</a>, we see each flux (<span class="math inline">\(f\)</span>) is a <em>Function</em> (<span class="math inline">\(F()\)</span>) of one or two pools:</p>
<ul>
<li>Uptake: <span class="math inline">\(f_1 = F(V,A)\)</span></li>
<li>Leaf and root litter, and throughfall: <span class="math inline">\(f_3 = F(V)\)</span></li>
<li>Root exudates, and throughfall: <span class="math inline">\(f_4 = F(V)\)</span></li>
</ul>
<p>Next, we want to represent these fluxes in a mathematical form.</p>
</div>
<div id="first-mathematical-form-for-plant-uptake" class="section level2">
<h2><span class="header-section-number">3.2</span> First mathematical form for plant uptake</h2>
<p>A common starting point for dynamics depending on two pools is the law of <em>mass action</em>. This states that the reaction rate is proportional the product of the pools. In the case of plant uptake of N, which depends on the amounts of N in the available pool and the vegetation pool, this would be <span class="math inline">\(aVA\)</span>, where <span class="math inline">\(a\)</span> is a proportionality constant. In some circumstances, these pools might also have exponents different than one (<span class="math inline">\(aV^1A^1\)</span>), such as <span class="math inline">\(aVA^2\)</span>. This occurs in chemistry when a reaction requires two molecules of “A” for each molecule of “V”. It might occur in ecology if a rate depends differentially on A and B.</p>
<p>Using the law of mass action for plant uptake, we will describe the fluxes in the simple N budget above (Fig. <a href="N.html#fig:hbnb3">3.2</a>) with the following expressions.</p>
<p><span class="math display">\[\begin{align}
\frac{dV}{dt} &amp;= a_{1}AV - a_{2}V - a_3 V\\
\frac{dA}{dt} &amp;= I_1 + a_{2}V +  a_{4}B - a_{5}A - a_{1}AV\\
\frac{dB}{dt} &amp;= I_2 + a_{3}V - a_{4}B - a_{6}B
\end{align}\]</span></p>
<p>Take the time to identify each term and think about the biology or physics that might govern each term.</p>
</div>
<div id="paramaterization" class="section level2">
<h2><span class="header-section-number">3.3</span> Paramaterization</h2>
<p>Parameteriztion is what we call assigning numerical values to mathematical parameters. Here, we find initial estimates for the parameters in our model. We use the literature for this purpose <span class="citation">(Bormann, Likens, and Melillo <a href="#ref-Bormann1977" role="doc-biblioref">1977</a>)</span>.</p>
<p>If we have the data (we do) and relatively simple mathematical forms
(we do), it is fairly straightforward to estimate parameters. For
instance, we decided that net mineralization would be directly
proportional to the size of the organic pool, <span class="math inline">\(B\)</span>, that is, <span class="math inline">\(F_4 = a_4B\)</span>. To calculate <span class="math inline">\(a_4\)</span>, we substitute data where we can, and solve
what we need.
<span class="math display">\[\begin{align*}
  F_2 &amp;= a_4 B\\
  69.6 &amp;= a_4 4700 \\
  a_4 &amp;= \frac{69.6}{4700}\\
  a_4 &amp;\approx 0.015
\end{align*}\]</span>
We use the same approach for second order equations as well.</p>
<table>
<caption>
<span id="tab:unnamed-chunk-6">Table 3.1: </span>Parameters, variables, units and estimates for a simplified model of Bormann et al. (1977). All fluxes (<span class="math inline">\(dX/dy\)</span>) are in units of kg ha<span class="math inline">\(^{-1}\)</span> y<span class="math inline">\(^{-1}\)</span>. (Note that calculations should not be included in your final table, but are presented here for comparison to your own calculations.)
</caption>
<thead>
<tr>
<th style="text-align:left;">
p.or.V
</th>
<th style="text-align:center;">
units
</th>
<th style="text-align:center;">
Estimate
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<span class="math inline">\(A, B, V\)</span> state variables
</td>
<td style="text-align:center;">
kg ha<span class="math inline">\(^{-1}\)</span>
</td>
<td style="text-align:center;">
<span class="math inline">\(26, 4700, 532\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(a_1\)</span>, uptake rate by V from A
</td>
<td style="text-align:center;">
(kg ha<span class="math inline">\(^{-1}\)</span>)<span class="math inline">\(^{-1}\)</span> y<span class="math inline">\(^{-1}\)</span>
</td>
<td style="text-align:center;">
<span class="math inline">\(79.6 / (26 \cdot 532) = 0.0058\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(a_2\)</span>, loss rate from V to A
</td>
<td style="text-align:center;">
y<span class="math inline">\(^{-1}\)</span>
</td>
<td style="text-align:center;">
<span class="math inline">\((6.6 + 0.8) / 532 = 0.014\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(a_3\)</span>, loss rate from V to B
</td>
<td style="text-align:center;">
(kg ha<span class="math inline">\(^{-1}\)</span>)<span class="math inline">\(^{-1}\)</span> y<span class="math inline">\(^{-1}\)</span>
</td>
<td style="text-align:center;">
<span class="math inline">\((54.2 + 2.7 + 0.1 + 6.2 ) / 532 = 0.00022\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(a_4\)</span>, mineralization
</td>
<td style="text-align:center;">
y<span class="math inline">\(^{-1}\)</span>
</td>
<td style="text-align:center;">
<span class="math inline">\(69.6 / 4700 = 0.015\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(a_5\)</span>, export from A
</td>
<td style="text-align:center;">
y<span class="math inline">\(^{-1}\)</span>
</td>
<td style="text-align:center;">
<span class="math inline">\(3.9 /26 = 0.15\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(a_6\)</span>, export from B
</td>
<td style="text-align:center;">
y<span class="math inline">\(^{-1}\)</span>
</td>
<td style="text-align:center;">
<span class="math inline">\(0.1/4700 = 0.000021\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(I_1\)</span>, bulk precip
</td>
<td style="text-align:center;">
kg ha<span class="math inline">\(^{-1}\)</span> y<span class="math inline">\(^{-1}\)</span>
</td>
<td style="text-align:center;">
<span class="math inline">\(6.5\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(I_2\)</span>, N fixation
</td>
<td style="text-align:center;">
kg ha<span class="math inline">\(^{-1}\)</span> y<span class="math inline">\(^{-1}\)</span>
</td>
<td style="text-align:center;">
<span class="math inline">\(14.2\)</span>
</td>
</tr>
</tbody>
</table>
<p>Enter parameters into R.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="N.html#cb6-1"></a><span class="co"># Atmospheric inputs</span></span>
<span id="cb6-2"><a href="N.html#cb6-2"></a><span class="co">##  Precip</span></span>
<span id="cb6-3"><a href="N.html#cb6-3"></a>i1 &lt;-<span class="st"> </span><span class="fl">6.5</span></span>
<span id="cb6-4"><a href="N.html#cb6-4"></a><span class="co">## fixation</span></span>
<span id="cb6-5"><a href="N.html#cb6-5"></a>i2 &lt;-<span class="st"> </span><span class="fl">14.2</span></span>
<span id="cb6-6"><a href="N.html#cb6-6"></a><span class="co"># uptake</span></span>
<span id="cb6-7"><a href="N.html#cb6-7"></a>a1 &lt;-<span class="st"> </span><span class="fl">79.6</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">26</span> <span class="op">*</span><span class="st"> </span><span class="dv">532</span>)</span>
<span id="cb6-8"><a href="N.html#cb6-8"></a><span class="co"># throughfall and exudates (inorganic)</span></span>
<span id="cb6-9"><a href="N.html#cb6-9"></a>a2 &lt;-<span class="st"> </span>(<span class="fl">6.6</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.8</span>) <span class="op">/</span><span class="st"> </span><span class="dv">532</span></span>
<span id="cb6-10"><a href="N.html#cb6-10"></a><span class="co"># litter, throughfall, exudates (organic)</span></span>
<span id="cb6-11"><a href="N.html#cb6-11"></a>a3 &lt;-<span class="st"> </span>(<span class="fl">54.2</span> <span class="op">+</span><span class="st"> </span><span class="fl">2.7</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span> <span class="op">+</span><span class="st"> </span><span class="fl">6.2</span> ) <span class="op">/</span><span class="st"> </span><span class="dv">532</span></span>
<span id="cb6-12"><a href="N.html#cb6-12"></a><span class="co"># net mineralization</span></span>
<span id="cb6-13"><a href="N.html#cb6-13"></a>a4 &lt;-<span class="st"> </span><span class="fl">69.6</span> <span class="op">/</span><span class="st"> </span><span class="dv">4700</span></span>
<span id="cb6-14"><a href="N.html#cb6-14"></a><span class="co"># export from available</span></span>
<span id="cb6-15"><a href="N.html#cb6-15"></a>a5 &lt;-<span class="st"> </span><span class="fl">3.9</span> <span class="op">/</span><span class="dv">26</span></span>
<span id="cb6-16"><a href="N.html#cb6-16"></a><span class="co">#export from bound</span></span>
<span id="cb6-17"><a href="N.html#cb6-17"></a>a6 &lt;-<span class="st"> </span><span class="fl">0.1</span><span class="op">/</span><span class="dv">4700</span></span>
<span id="cb6-18"><a href="N.html#cb6-18"></a></span>
<span id="cb6-19"><a href="N.html#cb6-19"></a><span class="co"># make a vector</span></span>
<span id="cb6-20"><a href="N.html#cb6-20"></a>params &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="dt">a1 =</span> a1, <span class="dt">a2 =</span> a2, <span class="dt">a3 =</span> a3, <span class="dt">a4 =</span> a4, </span>
<span id="cb6-21"><a href="N.html#cb6-21"></a>            <span class="dt">a5 =</span> a5, <span class="dt">a6 =</span> a6, <span class="dt">i1 =</span> i1, <span class="dt">i2 =</span> i2)</span>
<span id="cb6-22"><a href="N.html#cb6-22"></a><span class="co">#...and look at it.</span></span>
<span id="cb6-23"><a href="N.html#cb6-23"></a>params</span></code></pre></div>
<pre><code>##           a1           a2           a3           a4           a5           a6 
## 5.754772e-03 1.390977e-02 1.187970e-01 1.480851e-02 1.500000e-01 2.127660e-05 
##           i1           i2 
## 6.500000e+00 1.420000e+01</code></pre>
</div>
<div id="mathematical-solution" class="section level2">
<h2><span class="header-section-number">3.4</span> Mathematical solution</h2>
<p>The <em>mathematical solution</em> is the process of making the
predictions using our model and our parameters. We <em>solve</em> the
model. With simple models, we can sometimes find analytical
solutions. For most ecosystem models, we have to solve the models
numerically using <em>numerical integration</em>.</p>
<p>Here we write a function that includes our system of differential
equations. This will allow R to integrate change through time.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="N.html#cb8-1"></a>bormann1 &lt;-<span class="st"> </span><span class="cf">function</span>(t, y, p) {</span>
<span id="cb8-2"><a href="N.html#cb8-2"></a>  <span class="co"># time, vector of state variables and parameters must be in this order</span></span>
<span id="cb8-3"><a href="N.html#cb8-3"></a>  <span class="co"># we can use as.list for both the state variables and parameters</span></span>
<span id="cb8-4"><a href="N.html#cb8-4"></a>  <span class="co"># a1 = uptake</span></span>
<span id="cb8-5"><a href="N.html#cb8-5"></a>  <span class="co"># a2 = loss from veg to avail</span></span>
<span id="cb8-6"><a href="N.html#cb8-6"></a>  <span class="co"># a3 = loss from veg to bound</span></span>
<span id="cb8-7"><a href="N.html#cb8-7"></a>  <span class="co"># a4 = net mineralization</span></span>
<span id="cb8-8"><a href="N.html#cb8-8"></a>  <span class="co"># a5 = export from avail</span></span>
<span id="cb8-9"><a href="N.html#cb8-9"></a>  <span class="co"># a6 = export from bound</span></span>
<span id="cb8-10"><a href="N.html#cb8-10"></a>  <span class="kw">with</span>( <span class="kw">as.list</span>( <span class="kw">c</span>(y, p) ), {</span>
<span id="cb8-11"><a href="N.html#cb8-11"></a>    dV.dt &lt;-<span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>A <span class="op">*</span><span class="st"> </span>V <span class="op">-</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>V <span class="op">-</span><span class="st"> </span>a3 <span class="op">*</span><span class="st"> </span>V</span>
<span id="cb8-12"><a href="N.html#cb8-12"></a>    dA.dt &lt;-<span class="st"> </span>i1 <span class="op">+</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>V <span class="op">+</span><span class="st"> </span>a4 <span class="op">*</span><span class="st"> </span>B <span class="op">-</span><span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>A <span class="op">*</span><span class="st"> </span>V <span class="op">-</span><span class="st"> </span>a5 <span class="op">*</span><span class="st"> </span>A </span>
<span id="cb8-13"><a href="N.html#cb8-13"></a>    dB.dt &lt;-<span class="st"> </span>i2 <span class="op">+</span><span class="st"> </span>a3 <span class="op">*</span><span class="st"> </span>V <span class="op">-</span><span class="st"> </span>a4 <span class="op">*</span><span class="st"> </span>B <span class="op">-</span><span class="st"> </span>a6 <span class="op">*</span><span class="st"> </span>B </span>
<span id="cb8-14"><a href="N.html#cb8-14"></a>    <span class="co"># Here we return a list whose first element is the vector of</span></span>
<span id="cb8-15"><a href="N.html#cb8-15"></a>    <span class="co"># rates of change for the state variables. The first element must be these rates,</span></span>
<span id="cb8-16"><a href="N.html#cb8-16"></a>    <span class="co"># in the same order as the state variables in y</span></span>
<span id="cb8-17"><a href="N.html#cb8-17"></a>    <span class="co"># The second element is the total N in the system</span></span>
<span id="cb8-18"><a href="N.html#cb8-18"></a>    <span class="kw">return</span>(<span class="kw">list</span>( <span class="kw">c</span>(dV.dt, dA.dt, dB.dt), </span>
<span id="cb8-19"><a href="N.html#cb8-19"></a>                 <span class="dt">total =</span> V <span class="op">+</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>B </span>
<span id="cb8-20"><a href="N.html#cb8-20"></a>                 )  )})</span>
<span id="cb8-21"><a href="N.html#cb8-21"></a>}</span></code></pre></div>
<p>Now that we have the function, we tell R what to do with it. We will define the <em>initial state of the system</em>, and then tell R which time point we want it to return.</p>
<p>The initial state of the system is the set of starting values for the state variables. We could choose any values, but I select the values given in <span class="citation">Bormann, Likens, and Melillo (<a href="#ref-Bormann1977" role="doc-biblioref">1977</a>)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="N.html#cb9-1"></a>initial.state &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="dt">V =</span> <span class="dv">532</span>, <span class="dt">A =</span> <span class="dv">26</span>, <span class="dt">B =</span> <span class="dv">4700</span>)</span></code></pre></div>
</div>
<div id="calibration-take-1" class="section level2">
<h2><span class="header-section-number">3.5</span> Calibration, take 1</h2>
<p>Calibration, in general, is the process of finding better estimates
for our parameters. We can do that by looking into the literature, or
by using independent data to estimates parameters directly.</p>
<p>If we take a look at the model output (above), we see both differences
and similarities with Bormann et al. What are they?</p>
<p>What if we run it out longer, say, 100 years?</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="N.html#cb10-1"></a>time &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">250</span></span>
<span id="cb10-2"><a href="N.html#cb10-2"></a>out &lt;-<span class="st"> </span><span class="kw">ode</span>(<span class="dt">y =</span> initial.state, <span class="dt">times=</span>time, <span class="dt">func=</span>bormann1, <span class="dt">parms =</span> params)</span>
<span id="cb10-3"><a href="N.html#cb10-3"></a><span class="kw">head</span>(<span class="kw">round</span>(out,<span class="dv">1</span>))</span></code></pre></div>
<pre><code>##      time     V    A      B  total
## [1,]    0 532.0 26.0 4700.0 5258.0
## [2,]    1 540.8 25.8 4708.2 5274.7
## [3,]    2 548.8 25.5 4717.2 5291.5
## [4,]    3 556.0 25.2 4727.0 5308.3
## [5,]    4 562.6 25.0 4737.5 5325.1
## [6,]    5 568.6 24.8 4748.6 5342.0</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="N.html#cb12-1"></a><span class="co">#plot(out)</span></span></code></pre></div>
<p>Use <code>gather()</code> and <code>ggplot()</code> to make a graph. We use <code>gather()</code> gather multiple columns into one with a new name (<code>value=kg.N</code>), keeping track of the names of the original columns in a new column (<code>key=State.var</code>). We can use <code>spread()</code> if we ever want to spread those columns back out.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="N.html#cb13-1"></a>outL &lt;-<span class="st"> </span>out <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-2"><a href="N.html#cb13-2"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-3"><a href="N.html#cb13-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>( <span class="dt">cols=</span><span class="op">-</span>time, <span class="dt">names_to=</span><span class="st">&quot;State.var&quot;</span>, <span class="dt">values_to=</span><span class="st">&quot;kg.N&quot;</span>)</span>
<span id="cb13-4"><a href="N.html#cb13-4"></a></span>
<span id="cb13-5"><a href="N.html#cb13-5"></a><span class="kw">ggplot</span>(outL, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>kg.N)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>State.var, <span class="dt">scale=</span><span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-10"></span>
<img src="figs/unnamed-chunk-10-1.png" alt="Dynamics of a simple N budget, based on Bormann et al. (1977)." width="66%" />
<p class="caption">
Figure 3.3: Dynamics of a simple N budget, based on Bormann et al. (1977).
</p>
</div>
<p>In some ways, we have been moderately successful in our first pass at
converting a purely budgetary model into a dynamic process model. We
mimicked total load, and see similar changes through time of all the
state variables.</p>
<p><strong>Questions to ponder</strong></p>
<p>We replicated approximately the N budget of Bormann et al. (1977), but
clearly vegetation cannot keep accumulating N indefinitely.</p>
<p>What are our next steps? One logical step is to assume that as vegetation eventually gets limited by some factor or resource that is not in our model. If, at first approximation, the vegetation reaches a carrying capacity independent of high resource availability, we can use an approximation suggested by Soetaert and Hermann (2009) for <em>self-limitation</em>,
<span class="math display">\[f(X)V\left(1-\frac{V}{K}\right)\]</span>
where <span class="math inline">\(f(X)\)</span> is everything else that regulates mass-specific growth rate.</p>
<p><strong>Exercise</strong></p>
<p>Include self-limitation in your model of vegetation, estimate <span class="math inline">\(K\)</span>, and produce output.</p>
</div>
<div id="budget-take-ii" class="section level2">
<h2><span class="header-section-number">3.6</span> Budget, take II</h2>
<p>Remember that following our template, we have a maximum rate times resource and self limitation, and inhibition. Currently, we have
<span class="math display">\[\frac{dV}{dt} = a_{1}AV - a_{2}V - a_3 V\]</span>
and rearranging,
<span class="math display">\[\frac{dV}{dt} = \left(a_{1}A - a_{2} - a_3\right) V\]</span>
If we add self-limitation, we get
<span class="math display">\[\frac{dV}{dt} = \left(a_{1}A - a_{2} - a_3\right) V \left(1-\frac{V}{K}\right)\]</span>
where <span class="math inline">\(K\)</span> is the maximum amount of live vegetation that the ecosystem can sustain, in kg,N,ha<span class="math inline">\(^{-1}\)</span>. We don’t know exactly what that is yet, but we may be able to get estimates from the literature. For know we can pretend that it is just a bit more than was there in the mid-1970s, say, <span class="math inline">\(K=600\)</span>.</p>
<p>Now we rewrite the R function with self-limitation.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="N.html#cb14-1"></a>bormann2 &lt;-<span class="st"> </span><span class="cf">function</span>(t, y, p) {</span>
<span id="cb14-2"><a href="N.html#cb14-2"></a>  <span class="co"># time, vector of state variables and parameters must be in this order</span></span>
<span id="cb14-3"><a href="N.html#cb14-3"></a>  <span class="co"># we can use as.list for both the state variables and parameters</span></span>
<span id="cb14-4"><a href="N.html#cb14-4"></a>  <span class="co"># a1 = uptake</span></span>
<span id="cb14-5"><a href="N.html#cb14-5"></a>  <span class="co"># a2 = loss from veg to avail</span></span>
<span id="cb14-6"><a href="N.html#cb14-6"></a>  <span class="co"># a3 = loss from veg to bound</span></span>
<span id="cb14-7"><a href="N.html#cb14-7"></a>  <span class="co"># a4 = net mineralization</span></span>
<span id="cb14-8"><a href="N.html#cb14-8"></a>  <span class="co"># a5 = export from avail</span></span>
<span id="cb14-9"><a href="N.html#cb14-9"></a>  <span class="co"># a6 = export from bound</span></span>
<span id="cb14-10"><a href="N.html#cb14-10"></a>  <span class="kw">with</span>( <span class="kw">as.list</span>( <span class="kw">c</span>(y, p) ), {</span>
<span id="cb14-11"><a href="N.html#cb14-11"></a>    dV.dt &lt;-<span class="st"> </span>(a1 <span class="op">*</span><span class="st"> </span>A  <span class="op">-</span><span class="st"> </span>a2  <span class="op">-</span><span class="st"> </span>a3) <span class="op">*</span><span class="st"> </span>V <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>V<span class="op">/</span>K)</span>
<span id="cb14-12"><a href="N.html#cb14-12"></a>    dA.dt &lt;-<span class="st"> </span>i1 <span class="op">+</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>V <span class="op">+</span><span class="st"> </span>a4 <span class="op">*</span><span class="st"> </span>B <span class="op">-</span><span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>A <span class="op">*</span><span class="st"> </span>V <span class="op">-</span><span class="st"> </span>a5 <span class="op">*</span><span class="st"> </span>A </span>
<span id="cb14-13"><a href="N.html#cb14-13"></a>    dB.dt &lt;-<span class="st"> </span>i2 <span class="op">+</span><span class="st"> </span>a3 <span class="op">*</span><span class="st"> </span>V <span class="op">-</span><span class="st"> </span>a4 <span class="op">*</span><span class="st"> </span>B <span class="op">-</span><span class="st"> </span>a6 <span class="op">*</span><span class="st"> </span>B </span>
<span id="cb14-14"><a href="N.html#cb14-14"></a>    <span class="co"># Here we return a list whose first element is the vector of</span></span>
<span id="cb14-15"><a href="N.html#cb14-15"></a>    <span class="co"># rates of change for the state variables. The first element must be these rates,</span></span>
<span id="cb14-16"><a href="N.html#cb14-16"></a>    <span class="co"># in the same order as the state variables in y</span></span>
<span id="cb14-17"><a href="N.html#cb14-17"></a>    <span class="co"># The second element is the total N in the system</span></span>
<span id="cb14-18"><a href="N.html#cb14-18"></a>    <span class="kw">return</span>(<span class="kw">list</span>( <span class="kw">c</span>(dV.dt, dA.dt, dB.dt), </span>
<span id="cb14-19"><a href="N.html#cb14-19"></a>                 <span class="dt">total =</span> V <span class="op">+</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>B </span>
<span id="cb14-20"><a href="N.html#cb14-20"></a>                 )  )})</span>
<span id="cb14-21"><a href="N.html#cb14-21"></a>}</span></code></pre></div>
<p>We can add a new parameter to our vector of parameters, and then solve our new function <code>bormann2</code> for the same time interval, and plot it.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="N.html#cb15-1"></a>params[<span class="st">&quot;K&quot;</span>] &lt;-<span class="st"> </span><span class="dv">600</span></span>
<span id="cb15-2"><a href="N.html#cb15-2"></a>out &lt;-<span class="st"> </span><span class="kw">ode</span>(<span class="dt">y =</span> initial.state, <span class="dt">times=</span>time, <span class="dt">func=</span>bormann2, <span class="dt">parms =</span> params)</span>
<span id="cb15-3"><a href="N.html#cb15-3"></a>outL2 &lt;-<span class="st"> </span>out <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-4"><a href="N.html#cb15-4"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb15-5"><a href="N.html#cb15-5"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols=</span><span class="op">-</span>time, <span class="dt">names_to=</span><span class="st">&quot;State.var&quot;</span>, <span class="dt">values_to=</span><span class="st">&quot;kg.N&quot;</span>)</span>
<span id="cb15-6"><a href="N.html#cb15-6"></a></span>
<span id="cb15-7"><a href="N.html#cb15-7"></a><span class="kw">ggplot</span>(outL2, <span class="kw">aes</span>(time, kg.N)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>State.var, <span class="dt">scale=</span><span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-11"></span>
<img src="figs/unnamed-chunk-11-1.png" alt="Dynamics of an N budget, assuming density-dependence in vegetation with a fixed carrying capacity (Bormann et al. 1977)." width="66%" />
<p class="caption">
Figure 3.4: Dynamics of an N budget, assuming density-dependence in vegetation with a fixed carrying capacity (Bormann et al. 1977).
</p>
</div>
<p>Unlike our first model of this system, we see state variables on curved trajectories and perhaps reaching asymptotes. This makes greater intuitive sense - over the short term, it is the same as the simple N budget shown in <span class="citation">Bormann, Likens, and Melillo (<a href="#ref-Bormann1977" role="doc-biblioref">1977</a>)</span> and it also shows a reasonable longterm trajectory for the vegetation, and the predicted consequences for the available and bound pools.</p>

</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-Bormann1977">
<p>Bormann, F H, G E Likens, and J M Melillo. 1977. “Nitrogen budget for an aggrading northern hardwood forest ecosystem.” <em>Science (New York, N.Y.)</em> 196 (4293): 981–3.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="lake-metabolism.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
