<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Model Sensitivity | A Primer of Ecosystem Modeling - a work in progress</title>
  <meta name="description" content="This provides a part of a foundation in understanding ecosystem models." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Model Sensitivity | A Primer of Ecosystem Modeling - a work in progress" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This provides a part of a foundation in understanding ecosystem models." />
  <meta name="github-repo" content="HankStevens/ecosystems-primer" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Model Sensitivity | A Primer of Ecosystem Modeling - a work in progress" />
  
  <meta name="twitter:description" content="This provides a part of a foundation in understanding ecosystem models." />
  

<meta name="author" content="Hank Stevens, BIO 672" />


<meta name="date" content="2023-02-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="npzd---a-simple-aquatic-ecosystem.html"/>
<link rel="next" href="MEL.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#must-dos"><i class="fa fa-check"></i><b>1.1</b> Must do’s</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#a-couple-of-useful-citations"><i class="fa fa-check"></i><b>1.2</b> A couple of useful citations</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#a-final-suggestion"><i class="fa fa-check"></i><b>1.3</b> A final suggestion</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction to ecosystem models</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#why-models"><i class="fa fa-check"></i><b>2.1</b> Why models?</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#whats-an-ecosystem"><i class="fa fa-check"></i><b>2.2</b> What’s an ecosystem?</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#whats-an-ecosystem-model"><i class="fa fa-check"></i><b>2.3</b> What’s an ecosystem model?</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#units-of-terms"><i class="fa fa-check"></i><b>2.3.1</b> Units of terms</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro.html"><a href="intro.html#other-ideas"><i class="fa fa-check"></i><b>2.3.2</b> Other ideas</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#steps-in-modeling"><i class="fa fa-check"></i><b>2.4</b> Steps in modeling</a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#an-example-in-r"><i class="fa fa-check"></i><b>2.5</b> An example in R</a></li>
<li class="chapter" data-level="2.6" data-path="intro.html"><a href="intro.html#analytical-solutions-to-rate-equations"><i class="fa fa-check"></i><b>2.6</b> Analytical solutions to rate equations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="N.html"><a href="N.html"><i class="fa fa-check"></i><b>3</b> Describing a nitrogen budget</a>
<ul>
<li class="chapter" data-level="3.1" data-path="N.html"><a href="N.html#getting-started"><i class="fa fa-check"></i><b>3.1</b> Getting started</a></li>
<li class="chapter" data-level="3.2" data-path="N.html"><a href="N.html#mathematical-forms"><i class="fa fa-check"></i><b>3.2</b> Mathematical forms</a></li>
<li class="chapter" data-level="3.3" data-path="N.html"><a href="N.html#paramaterization"><i class="fa fa-check"></i><b>3.3</b> Paramaterization</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="N.html"><a href="N.html#instantaneous-rates"><i class="fa fa-check"></i><b>3.3.1</b> Instantaneous rates</a></li>
<li class="chapter" data-level="3.3.2" data-path="N.html"><a href="N.html#a-sign-of-the-times"><i class="fa fa-check"></i><b>3.3.2</b> A sign of the times</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="N.html"><a href="N.html#mathematical-solution"><i class="fa fa-check"></i><b>3.4</b> Mathematical solution</a></li>
<li class="chapter" data-level="3.5" data-path="N.html"><a href="N.html#add-self-limitation"><i class="fa fa-check"></i><b>3.5</b> Add self-limitation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lake-metabolism.html"><a href="lake-metabolism.html"><i class="fa fa-check"></i><b>4</b> Lake Metabolism</a>
<ul>
<li class="chapter" data-level="4.1" data-path="lake-metabolism.html"><a href="lake-metabolism.html#estimating-productivity"><i class="fa fa-check"></i><b>4.1</b> Estimating Productivity</a></li>
<li class="chapter" data-level="4.2" data-path="lake-metabolism.html"><a href="lake-metabolism.html#by-hand-but-in-r"><i class="fa fa-check"></i><b>4.2</b> By hand, but in R</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="lake-metabolism.html"><a href="lake-metabolism.html#plot-one-cycle"><i class="fa fa-check"></i><b>4.2.1</b> Plot one cycle</a></li>
<li class="chapter" data-level="4.2.2" data-path="lake-metabolism.html"><a href="lake-metabolism.html#average-of-all-nights"><i class="fa fa-check"></i><b>4.2.2</b> Average of all nights</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="lake-metabolism.html"><a href="lake-metabolism.html#the-lakemetabolizer-package"><i class="fa fa-check"></i><b>4.3</b> The LakeMetabolizer package</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="npzd---a-simple-aquatic-ecosystem.html"><a href="npzd---a-simple-aquatic-ecosystem.html"><i class="fa fa-check"></i><b>5</b> NPZD - a simple aquatic ecosystem</a>
<ul>
<li class="chapter" data-level="5.1" data-path="npzd---a-simple-aquatic-ecosystem.html"><a href="npzd---a-simple-aquatic-ecosystem.html#this-task"><i class="fa fa-check"></i><b>5.1</b> This task</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="npzd---a-simple-aquatic-ecosystem.html"><a href="npzd---a-simple-aquatic-ecosystem.html#create-an-r-script-of-npzd"><i class="fa fa-check"></i><b>5.1.1</b> Create an R script of NPZD</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="model-sensitivity.html"><a href="model-sensitivity.html"><i class="fa fa-check"></i><b>6</b> Model Sensitivity</a>
<ul>
<li class="chapter" data-level="6.1" data-path="model-sensitivity.html"><a href="model-sensitivity.html#model-sensitivity-1"><i class="fa fa-check"></i><b>6.1</b> Model Sensitivity</a></li>
<li class="chapter" data-level="6.2" data-path="model-sensitivity.html"><a href="model-sensitivity.html#local-sensitivity"><i class="fa fa-check"></i><b>6.2</b> Local sensitivity</a></li>
<li class="chapter" data-level="6.3" data-path="model-sensitivity.html"><a href="model-sensitivity.html#assessing-sensitivity-in-a-nitrogen-budget-model"><i class="fa fa-check"></i><b>6.3</b> Assessing sensitivity in a nitrogen budget model</a></li>
<li class="chapter" data-level="6.4" data-path="model-sensitivity.html"><a href="model-sensitivity.html#sensitivity-in-an-aquatic-ecosystem"><i class="fa fa-check"></i><b>6.4</b> Sensitivity in an aquatic ecosystem</a></li>
<li class="chapter" data-level="6.5" data-path="model-sensitivity.html"><a href="model-sensitivity.html#letting-sensitivity-analysis-guide-next-steps"><i class="fa fa-check"></i><b>6.5</b> Letting Sensitivity Analysis Guide Next Steps</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="model-sensitivity.html"><a href="model-sensitivity.html#your-turn"><i class="fa fa-check"></i><b>6.5.1</b> Your turn</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="MEL.html"><a href="MEL.html"><i class="fa fa-check"></i><b>7</b> Multiple Element Limitation</a>
<ul>
<li class="chapter" data-level="7.1" data-path="MEL.html"><a href="MEL.html#rastetter-et-al.-1997"><i class="fa fa-check"></i><b>7.1</b> Rastetter et al. 1997</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="MEL.html"><a href="MEL.html#the-model"><i class="fa fa-check"></i><b>7.1.1</b> The model</a></li>
<li class="chapter" data-level="7.1.2" data-path="MEL.html"><a href="MEL.html#parameters"><i class="fa fa-check"></i><b>7.1.2</b> Parameters</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="MEL.html"><a href="MEL.html#implementing-mel"><i class="fa fa-check"></i><b>7.2</b> Implementing MEL</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="MEL.html"><a href="MEL.html#increasing-atmospheric-carbon-with-events-in-ode"><i class="fa fa-check"></i><b>7.2.1</b> Increasing atmospheric carbon with events in <code>ode()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>8</b> Optimization</a>
<ul>
<li class="chapter" data-level="8.1" data-path="optimization.html"><a href="optimization.html#introduction"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="optimization.html"><a href="optimization.html#bormann-logistic-model"><i class="fa fa-check"></i><b>8.2</b> Bormann logistic model</a></li>
<li class="chapter" data-level="8.3" data-path="optimization.html"><a href="optimization.html#fitting-a-model-to-data"><i class="fa fa-check"></i><b>8.3</b> Fitting a model to data</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="optimization.html"><a href="optimization.html#minimization"><i class="fa fa-check"></i><b>8.3.1</b> Minimization</a></li>
<li class="chapter" data-level="8.3.2" data-path="optimization.html"><a href="optimization.html#creating-the-objective-function"><i class="fa fa-check"></i><b>8.3.2</b> Creating the objective function</a></li>
<li class="chapter" data-level="8.3.3" data-path="optimization.html"><a href="optimization.html#optim"><i class="fa fa-check"></i><b>8.3.3</b> <code>optim()</code></a></li>
<li class="chapter" data-level="8.3.4" data-path="optimization.html"><a href="optimization.html#mle2"><i class="fa fa-check"></i><b>8.3.4</b> <code>mle2()</code></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="optimization.html"><a href="optimization.html#trajectory-matching"><i class="fa fa-check"></i><b>8.4</b> Trajectory matching</a></li>
<li class="chapter" data-level="8.5" data-path="optimization.html"><a href="optimization.html#two-or-more-parameters-at-a-time"><i class="fa fa-check"></i><b>8.5</b> Two (or more) parameters at a time</a></li>
<li class="chapter" data-level="8.6" data-path="optimization.html"><a href="optimization.html#other-considerations-weighting-deviations"><i class="fa fa-check"></i><b>8.6</b> Other considerations: weighting deviations</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="optimization.html"><a href="optimization.html#variance-weighted-errors"><i class="fa fa-check"></i><b>8.6.1</b> Variance weighted errors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="more-on-forcing-functions-using-data-inside-models.html"><a href="more-on-forcing-functions-using-data-inside-models.html"><i class="fa fa-check"></i><b>9</b> More On Forcing Functions: Using data inside models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="more-on-forcing-functions-using-data-inside-models.html"><a href="more-on-forcing-functions-using-data-inside-models.html#preliminaries"><i class="fa fa-check"></i><b>9.1</b> Preliminaries</a></li>
<li class="chapter" data-level="9.2" data-path="more-on-forcing-functions-using-data-inside-models.html"><a href="more-on-forcing-functions-using-data-inside-models.html#n-deposition"><i class="fa fa-check"></i><b>9.2</b> N deposition</a></li>
<li class="chapter" data-level="9.3" data-path="more-on-forcing-functions-using-data-inside-models.html"><a href="more-on-forcing-functions-using-data-inside-models.html#denitrification"><i class="fa fa-check"></i><b>9.3</b> Denitrification</a></li>
<li class="chapter" data-level="9.4" data-path="more-on-forcing-functions-using-data-inside-models.html"><a href="more-on-forcing-functions-using-data-inside-models.html#annual-temperature-as-a-forcing-function"><i class="fa fa-check"></i><b>9.4</b> Annual temperature as a forcing function</a></li>
<li class="chapter" data-level="9.5" data-path="more-on-forcing-functions-using-data-inside-models.html"><a href="more-on-forcing-functions-using-data-inside-models.html#in-fine"><i class="fa fa-check"></i><b>9.5</b> In fine</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>10</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Primer of Ecosystem Modeling - a work in progress</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-sensitivity" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Model Sensitivity<a href="model-sensitivity.html#model-sensitivity" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Reading: Chapter 11, Soetart and Herman (2009)</p>
<p>Model sensitivity is part of model testing and validation (Soetaert and Herman 2009). In this chapter, we assess model sensitivity, that is, the sensitivity of model outcoxmes to model inputs. Sometimes, those inputs are small perturbations of the state variables, and we often refer to this as local stability analysis. In contrast, here we investigate the sensitivity of model output to the values of parameters we use as input. This is what we do when we calculate the sensitivity and elasticity of a demographic projection matrix. One of the reasons we assess the sensitivity of model output to the values of parameters is to determine which parameters are most important in driving the dynamics of the model. Identifying the most important parameters</p>
<ul>
<li>provides understanding of the model dynamics</li>
<li>guides future research in making sure we have good estimates of those particular model parameters.</li>
</ul>
<p>Stability and sensitivity are, broadly speaking, opposites of each other. Stability is the tendency to remain intact, to persist, or return to a steady state, following a perturbation. Ecologists have a large <em>lingua jargona</em> to describe different types of stability. Sensitivity is the degree to which model outputs tend to deviate if one or more of their inputs change.</p>
<p>Before we begin, it is worth listing questions we should ask ourselves about any model.</p>
<ol style="list-style-type: decimal">
<li>Testing Solution Correctness
<ul>
<li>Is there an analytical solution against which we can check the model output?</li>
<li>Is there known data with which we can compare the output?</li>
</ul></li>
<li>Internal Logic
<ul>
<li>Do the state variables remain in their expected range (e.g., biomass &gt;= 0)?</li>
<li>If it is a closed system, do the state variables remain at zero if they are all set to zero?</li>
<li>Is mass balance preserved?</li>
</ul></li>
<li>Model Verification and Validity. Our data and model don’t agree. How do we proceed?
<ul>
<li>Are the <em>data</em> accurate and/or precise?</li>
<li>Does the <em>structure</em> of the model approximate the important processes?</li>
<li>Do the parameter values correspond to actual rates?</li>
</ul></li>
</ol>
<p>These are important questions. We would also like to know how certain we need to be about parameter values. Model output can be very insensitive or very sensitive to small changes in the values of model parameters. Sensitivity analysis helps us pinpoint parameters to which model output might be most sensitive, that is, parameters that can have big effects on model outcomes.</p>
<div id="model-sensitivity-1" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Model Sensitivity<a href="model-sensitivity.html#model-sensitivity-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>How <em>robust</em> or <em>stable</em> is our model to inevitable untruths? Is our model likely to give approximately correct answers given only approximately correct structure and parameters?</p>
<p>There are two forms of sensitivities that we can assess:</p>
<ul>
<li>responses to changes in parameters</li>
<li>responses to changes in state variables</li>
</ul>
<p>Also, we can assess global or local behavior:</p>
<ul>
<li>Global changes
<ol style="list-style-type: decimal">
<li>broad, systematic variation in a parameter.</li>
<li>permanence - do all state values remain &gt; 0?</li>
</ol></li>
<li>Local changes
<ol style="list-style-type: decimal">
<li>responses to very small changes in parameters.</li>
<li>responses to very small changes to state variables at equilibria.</li>
</ol></li>
</ul>
</div>
<div id="local-sensitivity" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Local sensitivity<a href="model-sensitivity.html#local-sensitivity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here we will assess the local sensitivity to parameters in our model of the Hubbard Brook nitrogen cycle.</p>
<p>To assess the local sensitivity of our model to parameters, we will use code that does the following:</p>
<ol style="list-style-type: decimal">
<li>Create a baseline, or reference data set of model output using our original parameter values.
<ul>
<li>To assess long term average behavior, we typically run the model a long time, throw away early transient dynamics. We then consider the remaining output as our baseline.</li>
<li>We could also assess short term responses instead, if we had a particular scenario in mind.</li>
</ul></li>
<li>Create a new parameter set that changes one parameter by a little bit. This deviate, or “little bit”, could be a very small percentage of the original value, or a small fixed value.</li>
<li>Rerun the model using
<ul>
<li>the new parameter set, and</li>
<li>an initial state that is the same as the first state of the baseline.</li>
</ul></li>
<li>Calculate the difference between the baseline and new model outputs at each time step. This “difference” may take several forms, such as the absolute difference, the difference relative to the original, the squared difference, or others.</li>
<li>Summarize the differences across time using the mean or median, or something else.</li>
<li>Rinse and repeat steps 1-5, for each parameter in the model.</li>
<li>Save the results in a form we can use.</li>
</ol>
<p>The above steps are an example of pseudocode. Pseudocode is a series of steps written in plain language that describe intermediate steps toward achieving some goal. The function we use follows these steps. It relies heavily on code in Chap. 11 of Soetart and Herman (2009). Below I describe arguments of the function. Let’s start by loading it.</p>
<p>Obtain a copy of <code>sensitivity.R</code> and <code>sens.fig.R</code> and put them in an appropriate directory. I use a folder called <code>code</code>. The R function <code>source()</code> runs an R script; if the script defines a function (as these do), you will then be able to use that function.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="model-sensitivity.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="do">## This script loads a function called, oddly enough, &quot;sensitivity&quot;</span></span>
<span id="cb66-2"><a href="model-sensitivity.html#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;code/sensitivity.R&quot;</span>)</span>
<span id="cb66-3"><a href="model-sensitivity.html#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ask for the arguments of the function</span></span>
<span id="cb66-4"><a href="model-sensitivity.html#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(<span class="st">&quot;sensitivity&quot;</span>)</span></code></pre></div>
<pre><code>## function (y.initial, times, func, parms, burnin = NULL, tiny = 0.001, 
##     dev.type = &quot;normalized&quot;, summary.type = &quot;arithmetic_mean&quot;) 
## NULL</code></pre>
<p>Some of the arguments are the same as for <code>ode()</code>.Here is a bit of how the function works:</p>
<ul>
<li><code>y.initial</code> is a named vector the starting point for the ODEs. By ‘named’, we mean that the elements have names, as in <code>y=c(A=1, B=2)</code>.</li>
<li><code>times</code> is the vector of times for which the user wants to assess sensitivity.</li>
<li><code>func</code> is the system of ODEs written for use with <code>ode()</code>.</li>
<li><code>parms</code> is the vector of parameter values used in <code>func</code>.</li>
<li><code>burnin</code> is the number of initial time steps to throw away. NULL causes the function to throw away the first half. Otherwise set an actual number (integer).</li>
<li><code>tiny</code> is the proportional deviation to the parameter (0.1 = 10% increase, -0.1 = 10% decrease).</li>
<li><code>summary.type</code> refers to how the time series of deviates are summarized. The current options are ‘arithmetic_mean’, ‘mean_absolute’ (the arthmetic means of absolute values of the deviates), or ‘RMSE’ (the root mean squared error).</li>
<li><code>dev.type</code> refers to the type of sensitivity, either the simple ‘deviate’ (dy), ‘sensitivity’ (dy/dp), ‘elasticity’ (d(log[y])/d(log[p])), ‘normalized’ ( [dy/y] / [dp/p]). Default is ‘normalized’ which is nearly identical to ‘elasticity’.</li>
</ul>
<p>The function returns a named list containing several elements:</p>
<ul>
<li><code>deviation.summary</code> is a data frame of the summarized deviates for each parameter (rows), for each state variable (columns).</li>
<li><code>dev.type</code> is the type of deviate used.</li>
<li><code>summary.type</code> is the type of summary of the time series used.</li>
<li><code>tiny</code> is size of proportional perturbation to parameters</li>
<li><code>sens.list</code> a list of each of the original time series.</li>
</ul>
</div>
<div id="assessing-sensitivity-in-a-nitrogen-budget-model" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Assessing sensitivity in a nitrogen budget model<a href="model-sensitivity.html#assessing-sensitivity-in-a-nitrogen-budget-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consult our previous chapter on the nitrogen budget of Hubbard Brook, watershed 6. If you have not already done so, make a script that contains nothing but the <code>bormann2</code> function. Copy the block of text where we define it, paste it into a new R script, and save it as <strong>bormann2.R</strong>.</p>
<p>Next we prepare our workspace, by removing extraneous objects.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="model-sensitivity.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>( <span class="at">list =</span> <span class="fu">ls</span>() ) <span class="co"># delete (remove) everything in the workspace.</span></span></code></pre></div>
<p>The next line of code loads and runs two files.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="model-sensitivity.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="do">## I put the script in a folder called &#39;code&#39; that resides inside</span></span>
<span id="cb69-2"><a href="model-sensitivity.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="do">## my working directory. The following line of code runs the code in </span></span>
<span id="cb69-3"><a href="model-sensitivity.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="do">## the script, and the script is located at code/bormann2.R</span></span>
<span id="cb69-4"><a href="model-sensitivity.html#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="model-sensitivity.html#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;code/bormann2.R&quot;</span>)</span>
<span id="cb69-6"><a href="model-sensitivity.html#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="model-sensitivity.html#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="do">## if you want to make sure that it loaded the right thing, type</span></span>
<span id="cb69-8"><a href="model-sensitivity.html#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="do">## bormann2 on your command line, or highlight the word, and run it with</span></span>
<span id="cb69-9"><a href="model-sensitivity.html#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Control-Enter</span></span>
<span id="cb69-10"><a href="model-sensitivity.html#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="model-sensitivity.html#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="do">## We also load code to calculate the sensitivities, </span></span>
<span id="cb69-12"><a href="model-sensitivity.html#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="do">## and also to create a time series figure of the deviations.</span></span>
<span id="cb69-13"><a href="model-sensitivity.html#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;code/sensitivity.R&quot;</span>) <span class="co"># sensitivities of all variables</span></span>
<span id="cb69-14"><a href="model-sensitivity.html#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;code/sens_fig.R&quot;</span>) <span class="co"># graph time series of sensitivity of one variable</span></span></code></pre></div>
<p>Next we begin to run it.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="model-sensitivity.html#cb70-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">c</span>( </span>
<span id="cb70-2"><a href="model-sensitivity.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="at">i1 =</span> <span class="fl">6.5</span>, <span class="co"># precip</span></span>
<span id="cb70-3"><a href="model-sensitivity.html#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="at">i2 =</span> <span class="fl">14.2</span>, <span class="co"># fixation</span></span>
<span id="cb70-4"><a href="model-sensitivity.html#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="at">a1 =</span> <span class="fl">79.6</span> <span class="sc">/</span> (<span class="dv">26</span> <span class="sc">*</span> <span class="dv">532</span>), <span class="co"># uptake</span></span>
<span id="cb70-5"><a href="model-sensitivity.html#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="at">a2 =</span> (<span class="fl">6.6</span> <span class="sc">+</span> <span class="fl">0.8</span>) <span class="sc">/</span> <span class="dv">532</span>, <span class="co"># throughfall and inorganic exudates</span></span>
<span id="cb70-6"><a href="model-sensitivity.html#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="at">a3 =</span> (<span class="fl">54.2</span> <span class="sc">+</span> <span class="fl">2.7</span> <span class="sc">+</span> <span class="fl">0.1</span> <span class="sc">+</span> <span class="fl">6.2</span> ) <span class="sc">/</span> <span class="dv">532</span>, <span class="co"># litter, throughfall, organic exudates</span></span>
<span id="cb70-7"><a href="model-sensitivity.html#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="at">a4 =</span> <span class="fl">69.6</span> <span class="sc">/</span> <span class="dv">4700</span>, <span class="co"># net mineralization</span></span>
<span id="cb70-8"><a href="model-sensitivity.html#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="at">a5 =</span> <span class="fl">3.9</span> <span class="sc">/</span><span class="dv">26</span>, <span class="co"># export from available</span></span>
<span id="cb70-9"><a href="model-sensitivity.html#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="at">a6 =</span> <span class="fl">0.1</span><span class="sc">/</span><span class="dv">4700</span>, <span class="co">#export from bound</span></span>
<span id="cb70-10"><a href="model-sensitivity.html#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="at">K=</span><span class="dv">600</span></span>
<span id="cb70-11"><a href="model-sensitivity.html#cb70-11" aria-hidden="true" tabindex="-1"></a>) <span class="co"># close parentheses</span></span>
<span id="cb70-12"><a href="model-sensitivity.html#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="model-sensitivity.html#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="model-sensitivity.html#cb70-14" aria-hidden="true" tabindex="-1"></a>initial.state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">V =</span> <span class="dv">532</span>, <span class="at">A =</span> <span class="dv">26</span>, <span class="at">B =</span> <span class="dv">4700</span>)</span>
<span id="cb70-15"><a href="model-sensitivity.html#cb70-15" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">500</span>, <span class="at">by =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Next we run the sensitivity analysis. We start with parameters and initial conditions.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="model-sensitivity.html#cb71-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">c</span>( </span>
<span id="cb71-2"><a href="model-sensitivity.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="at">i1 =</span> <span class="fl">6.5</span>, <span class="co"># precip</span></span>
<span id="cb71-3"><a href="model-sensitivity.html#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="at">i2 =</span> <span class="fl">14.2</span>, <span class="co"># fixation</span></span>
<span id="cb71-4"><a href="model-sensitivity.html#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="at">a1 =</span> <span class="fl">79.6</span> <span class="sc">/</span> (<span class="dv">26</span> <span class="sc">*</span> <span class="dv">532</span>), <span class="co"># uptake</span></span>
<span id="cb71-5"><a href="model-sensitivity.html#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="at">a2 =</span> (<span class="fl">6.6</span> <span class="sc">+</span> <span class="fl">0.8</span>) <span class="sc">/</span> <span class="dv">532</span>, <span class="co"># throughfall and inorganic exudates</span></span>
<span id="cb71-6"><a href="model-sensitivity.html#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="at">a3 =</span> (<span class="fl">54.2</span> <span class="sc">+</span> <span class="fl">2.7</span> <span class="sc">+</span> <span class="fl">0.1</span> <span class="sc">+</span> <span class="fl">6.2</span> ) <span class="sc">/</span> <span class="dv">532</span>, <span class="co"># litter, throughfall, organic exudates</span></span>
<span id="cb71-7"><a href="model-sensitivity.html#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="at">a4 =</span> <span class="fl">69.6</span> <span class="sc">/</span> <span class="dv">4700</span>, <span class="co"># net mineralization</span></span>
<span id="cb71-8"><a href="model-sensitivity.html#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="at">a5 =</span> <span class="fl">3.9</span> <span class="sc">/</span><span class="dv">26</span>, <span class="co"># export from available</span></span>
<span id="cb71-9"><a href="model-sensitivity.html#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="at">a6 =</span> <span class="fl">0.1</span><span class="sc">/</span><span class="dv">4700</span>, <span class="co">#export from bound</span></span>
<span id="cb71-10"><a href="model-sensitivity.html#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="at">K=</span><span class="dv">600</span></span>
<span id="cb71-11"><a href="model-sensitivity.html#cb71-11" aria-hidden="true" tabindex="-1"></a>) <span class="co"># close parentheses</span></span>
<span id="cb71-12"><a href="model-sensitivity.html#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="model-sensitivity.html#cb71-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-14"><a href="model-sensitivity.html#cb71-14" aria-hidden="true" tabindex="-1"></a>initial.state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">V =</span> <span class="dv">532</span>, <span class="at">A =</span> <span class="dv">26</span>, <span class="at">B =</span> <span class="dv">4700</span>)</span>
<span id="cb71-15"><a href="model-sensitivity.html#cb71-15" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">500</span>, <span class="at">by =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Next we do the sensitivity analysis. We will start with a graph, often a good place to start. The graph will show the actual deviations that arise when we alter each parameter one at a time by one percent.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="model-sensitivity.html#cb72-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">sens_fig</span>(<span class="st">&quot;A&quot;</span>, <span class="at">y.initial=</span>initial.state, </span>
<span id="cb72-2"><a href="model-sensitivity.html#cb72-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">times=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">func=</span>bormann2, <span class="at">parms=</span>params,</span>
<span id="cb72-3"><a href="model-sensitivity.html#cb72-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">burnin=</span><span class="dv">0</span>, <span class="at">tiny=</span><span class="fl">0.01</span>, <span class="at">relative=</span><span class="cn">FALSE</span> )</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="model-sensitivity.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(out, <span class="fu">aes</span>(Time, y, <span class="at">colour=</span>Perturbation)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>Parameter, <span class="at">scales=</span><span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:sensfig"></span>
<img src="figs/sensfig-1.png" alt="*Observed responses of the available N pool to a one percent change to each parameter.*" width="75%" />
<p class="caption">
Figure 6.1: <em>Observed responses of the available N pool to a one percent change to each parameter.</em>
</p>
</div>
<p>Note two features of these graphs. First, the change due to the system dynamics is relatively large and so obscures the change due the sensitivity. Second, note that sometimes a smaller parameter (here in blue) results in a higher value of the state variable.</p>
<p>It might be more informative the (i) focus on model output after it has approach the steady state, and (ii) examine the relative departure from the reference state. Relative change of 1.0 would mean that for a 1% change in a parameter, the state variable would also change by 1%.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="model-sensitivity.html#cb75-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">sens_fig</span>(<span class="st">&quot;A&quot;</span>, <span class="at">y.initial=</span>initial.state, </span>
<span id="cb75-2"><a href="model-sensitivity.html#cb75-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">times=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">func=</span>bormann2, <span class="at">parms=</span>params,</span>
<span id="cb75-3"><a href="model-sensitivity.html#cb75-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">burnin=</span><span class="dv">500</span>, <span class="at">tiny=</span><span class="fl">0.01</span>, <span class="at">relative=</span><span class="cn">TRUE</span> )</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="model-sensitivity.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(out, <span class="fu">aes</span>(Time, y, <span class="at">colour=</span>Perturbation)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>Parameter, <span class="at">scales=</span><span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:sensfigRel"></span>
<img src="figs/sensfigRel-1.png" alt="*Relative responses of the available N pool to a one percent change to each parameter. Note big differences in the values of the y-axes.*" width="75%" />
<p class="caption">
Figure 6.2: <em>Relative responses of the available N pool to a one percent change to each parameter. Note big differences in the values of the y-axes.</em>
</p>
</div>
<p>These graphs show that the state variable responds very consistently through time. In systems with more complicated dynamics, that will not always be the case.</p>
<p>Next, we can assess each of the state variables and average across time.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="model-sensitivity.html#cb78-1" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">sensitivity</span>(<span class="at">y.initial=</span>initial.state, <span class="at">times=</span>t, </span>
<span id="cb78-2"><a href="model-sensitivity.html#cb78-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">func=</span>bormann2, <span class="at">parms=</span>params, </span>
<span id="cb78-3"><a href="model-sensitivity.html#cb78-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">dev.type=</span><span class="st">&#39;normalized&#39;</span>, </span>
<span id="cb78-4"><a href="model-sensitivity.html#cb78-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">summary.type=</span><span class="st">&quot;arithmetic_mean&quot;</span>)</span></code></pre></div>
<p>The output generates a list with seven elements, but to see this structure you need to use <code>str</code>.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="model-sensitivity.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Peak at the structure of the output</span></span>
<span id="cb79-2"><a href="model-sensitivity.html#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(b1)</span></code></pre></div>
<pre><code>## List of 7
##  $ deviation.summary:&#39;data.frame&#39;:   9 obs. of  5 variables:
##   ..$ parameters: chr [1:9] &quot;i1&quot; &quot;i2&quot; &quot;a1&quot; &quot;a2&quot; ...
##   ..$ V         : num [1:9] 3.71e-05 2.92e-05 2.94e-05 -2.01e-07 -2.68e-04 ...
##   ..$ A         : num [1:9] 0.0648 0.1042 -0.9535 0.0831 0.5228 ...
##   ..$ B         : num [1:9] 3.79e-05 1.23e-01 3.73e-05 9.81e-06 6.15e-01 ...
##   ..$ total     : num [1:9] 0.000319 0.110914 -0.004113 0.000371 0.556306 ...
##  $ dev.type         : chr &quot;normalized&quot;
##  $ summary.type     : chr &quot;arithmetic_mean&quot;
##  $ burnin           : NULL
##  $ tiny             : num 0.001
##  $ parms            : Named num [1:9] 6.5 14.2 0.00575 0.01391 0.1188 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:9] &quot;i1&quot; &quot;i2&quot; &quot;a1&quot; &quot;a2&quot; ...
##  $ sens.list        :List of 4
##   ..$ V    : num [1:251, 1:9] 0.00 4.51e-06 1.04e-05 1.61e-05 2.32e-05 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : NULL
##   .. .. ..$ : chr [1:9] &quot;i1&quot; &quot;i2&quot; &quot;a1&quot; &quot;a2&quot; ...
##   ..$ A    : num [1:251, 1:9] 0 0.0635 0.0654 0.0654 0.0654 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : NULL
##   .. .. ..$ : chr [1:9] &quot;i1&quot; &quot;i2&quot; &quot;a1&quot; &quot;a2&quot; ...
##   ..$ B    : num [1:251, 1:9] 0.00 5.70e-08 1.99e-07 8.61e-07 5.71e-06 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : NULL
##   .. .. ..$ : chr [1:9] &quot;i1&quot; &quot;i2&quot; &quot;a1&quot; &quot;a2&quot; ...
##   ..$ total: num [1:251, 1:9] 0 0.000277 0.000286 0.000287 0.000292 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : NULL
##   .. .. ..$ : chr [1:9] &quot;i1&quot; &quot;i2&quot; &quot;a1&quot; &quot;a2&quot; ...
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;sensitivity&quot; &quot;list&quot;</code></pre>
<p>However, if you just type <code>b1</code>, it will spit out just the summary of the deviations.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="model-sensitivity.html#cb81-1" aria-hidden="true" tabindex="-1"></a>b1</span></code></pre></div>
<pre><code>##   parameters             V             A             B         total
## 1         i1  3.705840e-05  0.0647565594  3.790716e-05  0.0003194970
## 2         i2  2.918269e-05  0.1041528053  1.225100e-01  0.1109138069
## 3         a1  2.940582e-05 -0.9535105388  3.728004e-05 -0.0041134439
## 4         a2 -2.014821e-07  0.0831473008  9.812943e-06  0.0003706962
## 5         a3 -2.681428e-04  0.5227930990  6.145104e-01  0.5563064925
## 6         a4  2.992411e-04  0.2238495782 -7.329505e-01 -0.6598425953
## 7         a5 -2.021901e-05 -0.0414509485 -5.222392e-06 -0.0001870163
## 8         a6  2.264389e-06 -0.0008868526 -1.040165e-03 -0.0009414854
## 9          K  8.470909e-01 -0.3190643353  4.950298e-01  0.5246217855</code></pre>
<p>If we want to use this summary, however, we need to specify <code>b1$deviation.summary</code></p>
<p>Next we would like to graph the summaries, for ease of interpretation.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="model-sensitivity.html#cb83-1" aria-hidden="true" tabindex="-1"></a>b1L <span class="ot">&lt;-</span> b1<span class="sc">$</span>deviation.summary <span class="sc">%&gt;%</span>  </span>
<span id="cb83-2"><a href="model-sensitivity.html#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="st">&quot;V&quot;</span><span class="sc">:</span><span class="st">&quot;total&quot;</span>)</span>
<span id="cb83-3"><a href="model-sensitivity.html#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>b1L, <span class="fu">aes</span>(<span class="at">x=</span>parameters, <span class="at">y=</span>value)) <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb83-4"><a href="model-sensitivity.html#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales=</span><span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-52"></span>
<img src="figs/unnamed-chunk-52-1.png" alt="*Model output is more sensitive to some parameters than others. In addition, different state variables are respond differently to different parameters. Note that the y-axis differs among the state variables.*" width="75%" />
<p class="caption">
Figure 6.3: <em>Model output is more sensitive to some parameters than others. In addition, different state variables are respond differently to different parameters. Note that the y-axis differs among the state variables.</em>
</p>
</div>
<p>We can also summarize across state variables, so that we have one effect of each parameter. Here we use just V, A, and B, and calculate the root mean squared error.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="model-sensitivity.html#cb84-1" aria-hidden="true" tabindex="-1"></a>rmse.SV <span class="ot">&lt;-</span> b1<span class="sc">$</span>deviation.summary <span class="sc">%&gt;%</span> </span>
<span id="cb84-2"><a href="model-sensitivity.html#cb84-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(V<span class="sc">:</span>B) <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="model-sensitivity.html#cb84-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">apply</span>(<span class="at">MARGIN=</span><span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">sqrt</span>( x<span class="sc">*</span>x <span class="sc">/</span> <span class="dv">3</span> ))</span>
<span id="cb84-4"><a href="model-sensitivity.html#cb84-4" aria-hidden="true" tabindex="-1"></a>SV <span class="ot">&lt;-</span> b1<span class="sc">$</span>deviation.summary <span class="sc">%&gt;%</span> </span>
<span id="cb84-5"><a href="model-sensitivity.html#cb84-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(V<span class="sc">:</span>B) </span>
<span id="cb84-6"><a href="model-sensitivity.html#cb84-6" aria-hidden="true" tabindex="-1"></a>rmse.SV <span class="ot">&lt;-</span> <span class="fu">t</span>( <span class="fu">apply</span>(SV, <span class="at">MARGIN=</span><span class="dv">1</span>, <span class="cf">function</span>(x) {</span>
<span id="cb84-7"><a href="model-sensitivity.html#cb84-7" aria-hidden="true" tabindex="-1"></a>      m <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb84-8"><a href="model-sensitivity.html#cb84-8" aria-hidden="true" tabindex="-1"></a>      sq <span class="ot">&lt;-</span> (x<span class="sc">-</span>m)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb84-9"><a href="model-sensitivity.html#cb84-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sqrt</span>( <span class="fu">mean</span>( sq ))</span>
<span id="cb84-10"><a href="model-sensitivity.html#cb84-10" aria-hidden="true" tabindex="-1"></a>   }) )</span>
<span id="cb84-11"><a href="model-sensitivity.html#cb84-11" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">p=</span>b1<span class="sc">$</span>deviation.summary<span class="sc">$</span>parameters, <span class="at">rmse=</span><span class="fu">as.numeric</span>(rmse.SV))</span>
<span id="cb84-12"><a href="model-sensitivity.html#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(p, rmse, <span class="at">data=</span>rmse, <span class="at">geom=</span><span class="st">&quot;col&quot;</span>)</span></code></pre></div>
<p><img src="figs/unnamed-chunk-53-1.png" width="75%" /></p>
<p>So,…into what should we direct our effort? What data do we want most want to collect? These sensitivities are likely to help us direct our attention where it would be most useful.</p>
</div>
<div id="sensitivity-in-an-aquatic-ecosystem" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Sensitivity in an aquatic ecosystem<a href="model-sensitivity.html#sensitivity-in-an-aquatic-ecosystem" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here we revisit the aquatic ecosystem model, NPZD, of Soetaert and Herman.</p>
<p>We load it, and define the parameters and initial state. Obtain a copy of the model, <code>NPZD.R</code>.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="model-sensitivity.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="do">## load the model</span></span>
<span id="cb85-2"><a href="model-sensitivity.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;code/NPZD.R&quot;</span>)</span>
<span id="cb85-3"><a href="model-sensitivity.html#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="model-sensitivity.html#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------#</span></span>
<span id="cb85-5"><a href="model-sensitivity.html#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="co"># define the model parameters: #</span></span>
<span id="cb85-6"><a href="model-sensitivity.html#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------#</span></span>
<span id="cb85-7"><a href="model-sensitivity.html#cb85-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-8"><a href="model-sensitivity.html#cb85-8" aria-hidden="true" tabindex="-1"></a>parameters<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="at">maxUptake          =</span><span class="fl">1.0</span>,       <span class="co"># /day</span></span>
<span id="cb85-9"><a href="model-sensitivity.html#cb85-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">ksPAR              =</span><span class="dv">140</span>,       <span class="co"># muEinst/m2/s</span></span>
<span id="cb85-10"><a href="model-sensitivity.html#cb85-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">ksDIN              =</span><span class="fl">0.5</span>,       <span class="co"># mmolN/m3</span></span>
<span id="cb85-11"><a href="model-sensitivity.html#cb85-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">maxGrazing         =</span><span class="fl">1.0</span>,       <span class="co"># /day</span></span>
<span id="cb85-12"><a href="model-sensitivity.html#cb85-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">ksGrazing          =</span><span class="fl">1.0</span>,       <span class="co"># mmolN/m3</span></span>
<span id="cb85-13"><a href="model-sensitivity.html#cb85-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">pFaeces            =</span><span class="fl">0.3</span>,       <span class="co"># -</span></span>
<span id="cb85-14"><a href="model-sensitivity.html#cb85-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">excretionRate      =</span><span class="fl">0.1</span>,       <span class="co"># /day</span></span>
<span id="cb85-15"><a href="model-sensitivity.html#cb85-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">mortalityRate      =</span><span class="fl">0.4</span>,       <span class="co"># /(mmolN/m3)/day </span></span>
<span id="cb85-16"><a href="model-sensitivity.html#cb85-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">mineralisationRate =</span><span class="fl">0.1</span>,       <span class="co"># /day</span></span>
<span id="cb85-17"><a href="model-sensitivity.html#cb85-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">chlNratio          =</span><span class="dv">1</span>)         <span class="co"># mgChl/mmolN</span></span>
<span id="cb85-18"><a href="model-sensitivity.html#cb85-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-19"><a href="model-sensitivity.html#cb85-19" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------#</span></span>
<span id="cb85-20"><a href="model-sensitivity.html#cb85-20" aria-hidden="true" tabindex="-1"></a><span class="co"># the initial conditions: #</span></span>
<span id="cb85-21"><a href="model-sensitivity.html#cb85-21" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------#</span></span>
<span id="cb85-22"><a href="model-sensitivity.html#cb85-22" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb85-23"><a href="model-sensitivity.html#cb85-23" aria-hidden="true" tabindex="-1"></a>state     <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="at">PHYTO   =</span><span class="dv">1</span>,   <span class="co"># state variable initial conditions, units mmolN/m3</span></span>
<span id="cb85-24"><a href="model-sensitivity.html#cb85-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">ZOO     =</span><span class="fl">0.1</span>,</span>
<span id="cb85-25"><a href="model-sensitivity.html#cb85-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">DETRITUS=</span><span class="fl">5.0</span>,</span>
<span id="cb85-26"><a href="model-sensitivity.html#cb85-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">DIN     =</span><span class="fl">5.0</span>)</span></code></pre></div>
<p>Next we run the dynamics for two years.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="model-sensitivity.html#cb86-1" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">730</span></span>
<span id="cb86-2"><a href="model-sensitivity.html#cb86-2" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">ode</span>(state, times, NPZD, parameters)</span>
<span id="cb86-3"><a href="model-sensitivity.html#cb86-3" aria-hidden="true" tabindex="-1"></a>out <span class="sc">%&gt;%</span> </span>
<span id="cb86-4"><a href="model-sensitivity.html#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-5"><a href="model-sensitivity.html#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">-</span>time, <span class="at">names_to=</span><span class="st">&quot;State.var&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-6"><a href="model-sensitivity.html#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(time, value)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>State.var, <span class="at">scale=</span><span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="figs/unnamed-chunk-55-1.png" width="75%" /></p>
<p>Next we check model sensitivity.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="model-sensitivity.html#cb87-1" aria-hidden="true" tabindex="-1"></a>outf <span class="ot">&lt;-</span> <span class="fu">sens_fig</span>(<span class="st">&quot;DIN&quot;</span>, <span class="at">y.initial=</span>state, </span>
<span id="cb87-2"><a href="model-sensitivity.html#cb87-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">times=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">func=</span>NPZD, <span class="at">parms=</span>parameters,</span>
<span id="cb87-3"><a href="model-sensitivity.html#cb87-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">burnin=</span><span class="dv">0</span>, <span class="at">tiny=</span><span class="fl">0.01</span>, <span class="at">relative=</span><span class="cn">TRUE</span> )</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="model-sensitivity.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(outf, <span class="fu">aes</span>(Time, y, <span class="at">colour=</span>Perturbation)) <span class="sc">+</span> </span>
<span id="cb89-2"><a href="model-sensitivity.html#cb89-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>Parameter, <span class="at">scales=</span><span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="figs/unnamed-chunk-56-1.png" width="75%" /></p>
<p>In this figure, we see that sensitivity varies through time. For most parameters, it can be small at some times and quite large at other times. We can see how sensitivity can depend to a huge degree on the time points at which we evaluate that sensitivity.</p>
<p>Here we summarize those across time.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="model-sensitivity.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># args(sensitivity)</span></span>
<span id="cb90-2"><a href="model-sensitivity.html#cb90-2" aria-hidden="true" tabindex="-1"></a>outd <span class="ot">&lt;-</span> <span class="fu">sensitivity</span>(state, times, NPZD, parameters,</span>
<span id="cb90-3"><a href="model-sensitivity.html#cb90-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dev.type =</span> <span class="st">&quot;normalized&quot;</span>, </span>
<span id="cb90-4"><a href="model-sensitivity.html#cb90-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">summary.type =</span> <span class="st">&quot;arithmetic_mean&quot;</span>)</span>
<span id="cb90-5"><a href="model-sensitivity.html#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="model-sensitivity.html#cb90-6" aria-hidden="true" tabindex="-1"></a>outd<span class="sc">$</span>deviation.summary <span class="sc">%&gt;%</span>  </span>
<span id="cb90-7"><a href="model-sensitivity.html#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">-</span>parameters) <span class="sc">%&gt;%</span></span>
<span id="cb90-8"><a href="model-sensitivity.html#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>parameters, <span class="at">y=</span>value)) <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb90-9"><a href="model-sensitivity.html#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">scales=</span><span class="st">&quot;free&quot;</span>) <span class="sc">+</span> </span>
<span id="cb90-10"><a href="model-sensitivity.html#cb90-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_flip</span>() <span class="co"># Flip x and y so we can see the parameter names</span></span></code></pre></div>
<p><img src="figs/fig.h-1.png" width="75%" /></p>
<p>Which parameters appear to have the greatest effect on model predictions?</p>
</div>
<div id="letting-sensitivity-analysis-guide-next-steps" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Letting Sensitivity Analysis Guide Next Steps<a href="model-sensitivity.html#letting-sensitivity-analysis-guide-next-steps" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>So, let’s say you find that the half saturation constant for grazing rate of phytoplankton by zooplankton, <span class="math inline">\(ks_{\mathrm{Grazing}}\)</span>, is relatively important in governing several state variables. You also believe that it is very poorly estimated. Because you believe that your estimate is very uncertain, you should probably investigate and reveal to your collaborators the effect of wide variation in this parameter.</p>
<p><em>. Make sure that you have exhausted your own data in its ability to estimate that constant. Perhaps we’ll explore that elsewhere.
</em> Make sure that you have exhausted the literature as you combed through older papers that might have estimates.
* Make sure that you’re exhausted generally.</p>
<p><strong>One of the trickiest</strong> aspects of gathering parameter estimates from the literature or from other people’s data is converting their units to units you need.</p>
<ul>
<li>What units do you need?
<ul>
<li>Are you trying to estimate a <strong>flux</strong> (the mass of material flowing from one compartment to another per unit time)?</li>
<li>Are you trying to estimate a <strong>mass-specific rate</strong> constant?</li>
</ul></li>
<li>What do others provide?
<ul>
<li>Estimates of moles or grams?</li>
<li>Molecular or elemental quantities (e.g., NH<span class="math inline">\(_4\)</span> or N)?</li>
<li>All or at least the important sources of elemental quantities (NH<span class="math inline">\(_4\)</span> and NO<span class="math inline">\(_3\)</span> vs. just one)?</li>
<li>Per unit area or volume?</li>
<li>What is their time scale?</li>
</ul></li>
</ul>
<p>Conversion between what others provide and what you need can bee tricky, but it is essential to get it right.</p>
<p>Assuming that you have worked hard at the above tasks but are still more in the dark than you would like, what is left to you? What folks often do is to rely on first principles and logical constraints to find upper and lower limits to the parameter, and display or summarize numerical the variation in outputs that result. The local sensitivity analysis showed us the <em>potential effects</em> of variation in parameters. Here what we want to do is determine for ourselves the potential variation in the parameter itself, and then use simulation to discover the consequences of the a priori variation in the parameter.</p>
<p>So, our current estimate of the grazing half saturation constant, <span class="math inline">\(ks_{\mathrm{Grazing}}\)</span>, is 1.0. If we examine <code>NPZD()</code>, we find that the shape of this resource limitation function:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="model-sensitivity.html#cb91-1" aria-hidden="true" tabindex="-1"></a>ksGr <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb91-2"><a href="model-sensitivity.html#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="do">## let Phytoplankton be x, and vary between 0 and 6 mmolN/m3</span></span>
<span id="cb91-3"><a href="model-sensitivity.html#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="do">## because that is the approximate range we see in the dynamics</span></span>
<span id="cb91-4"><a href="model-sensitivity.html#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(x<span class="sc">/</span>(ksGr <span class="sc">+</span> x), <span class="dv">0</span>, <span class="dv">6</span>)</span></code></pre></div>
<p><img src="figs/unnamed-chunk-57-1.png" width="75%" /></p>
<p>If we increase or decrease the half saturation constant, what will we see?</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="model-sensitivity.html#cb92-1" aria-hidden="true" tabindex="-1"></a>ksGr <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb92-2"><a href="model-sensitivity.html#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># let Phytoplankton vary more</span></span>
<span id="cb92-3"><a href="model-sensitivity.html#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(x<span class="sc">/</span>(ksGr[<span class="dv">1</span>] <span class="sc">+</span> x), <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb92-4"><a href="model-sensitivity.html#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(x<span class="sc">/</span>(ksGr[<span class="dv">2</span>] <span class="sc">+</span> x), <span class="dv">0</span>, <span class="dv">10</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb92-5"><a href="model-sensitivity.html#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(x<span class="sc">/</span>(ksGr[<span class="dv">3</span>] <span class="sc">+</span> x), <span class="dv">0</span>, <span class="dv">10</span>,  <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb92-6"><a href="model-sensitivity.html#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend=</span><span class="fu">paste</span>(ksGr), <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="figs/unnamed-chunk-58-1.png" width="75%" /></p>
<p>Given this range, is there some basis for selecting one of these? Recall that this is multiplied by the maximum grazing rate (and zooplankton); therefore, we might want to ask ourselves how that maximum rate was determined. For instance, was it estimated at moderate phytoplankton concentrations or when phytoplankton were truly unlimited? If we have some data from the literature suggesting particular values, we might use these as maxima and minima, or we might go beyond them.</p>
<p>Sometimes, all we have is a guess. If a parameter appears to be important, then we might simply pick a value and then double it and halve it, or investigate 10-fold increases. Here we do the former.</p>
<ul>
<li>Let the half saturation constant vary between 0.5 and 2.</li>
<li>Generate the dynamics.</li>
<li>Plot outputs together.</li>
</ul>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="model-sensitivity.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="do">## reference run</span></span>
<span id="cb93-2"><a href="model-sensitivity.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="do">## make a copy of the parameters</span></span>
<span id="cb93-3"><a href="model-sensitivity.html#cb93-3" aria-hidden="true" tabindex="-1"></a>myP <span class="ot">&lt;-</span> parameters</span>
<span id="cb93-4"><a href="model-sensitivity.html#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="do">## integrate and make a data frame</span></span>
<span id="cb93-5"><a href="model-sensitivity.html#cb93-5" aria-hidden="true" tabindex="-1"></a>out_1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>( <span class="fu">ode</span>(state, times, NPZD, myP) )</span>
<span id="cb93-6"><a href="model-sensitivity.html#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="model-sensitivity.html#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="do">## add identifier</span></span>
<span id="cb93-8"><a href="model-sensitivity.html#cb93-8" aria-hidden="true" tabindex="-1"></a>out_1 <span class="ot">&lt;-</span> out_1 <span class="sc">%&gt;%</span></span>
<span id="cb93-9"><a href="model-sensitivity.html#cb93-9" aria-hidden="true" tabindex="-1"></a>   <span class="do">## make a new column</span></span>
<span id="cb93-10"><a href="model-sensitivity.html#cb93-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">ksGrazing =</span> <span class="fl">1.0</span>) <span class="co"># code as text</span></span>
<span id="cb93-11"><a href="model-sensitivity.html#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="model-sensitivity.html#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Change the half saturation constant</span></span>
<span id="cb93-13"><a href="model-sensitivity.html#cb93-13" aria-hidden="true" tabindex="-1"></a>myP[<span class="st">&quot;ksGrazing&quot;</span>] <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb93-14"><a href="model-sensitivity.html#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="do">##rerun and make a data frame</span></span>
<span id="cb93-15"><a href="model-sensitivity.html#cb93-15" aria-hidden="true" tabindex="-1"></a>out_0<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>( <span class="fu">ode</span>(state, times, NPZD, myP) )</span>
<span id="cb93-16"><a href="model-sensitivity.html#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="do">## add identifier</span></span>
<span id="cb93-17"><a href="model-sensitivity.html#cb93-17" aria-hidden="true" tabindex="-1"></a>out_0<span class="fl">.5</span> <span class="ot">&lt;-</span> out_0<span class="fl">.5</span> <span class="sc">%&gt;%</span></span>
<span id="cb93-18"><a href="model-sensitivity.html#cb93-18" aria-hidden="true" tabindex="-1"></a>   <span class="do">## make a new column</span></span>
<span id="cb93-19"><a href="model-sensitivity.html#cb93-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">ksGrazing =</span> <span class="fl">0.5</span>) <span class="co"># code as text</span></span>
<span id="cb93-20"><a href="model-sensitivity.html#cb93-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-21"><a href="model-sensitivity.html#cb93-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Change the half saturation constant</span></span>
<span id="cb93-22"><a href="model-sensitivity.html#cb93-22" aria-hidden="true" tabindex="-1"></a>myP[<span class="st">&quot;ksGrazing&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb93-23"><a href="model-sensitivity.html#cb93-23" aria-hidden="true" tabindex="-1"></a><span class="do">## rerun and make a dataframe</span></span>
<span id="cb93-24"><a href="model-sensitivity.html#cb93-24" aria-hidden="true" tabindex="-1"></a>out_2<span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>( <span class="fu">ode</span>(state, times, NPZD, myP) )</span>
<span id="cb93-25"><a href="model-sensitivity.html#cb93-25" aria-hidden="true" tabindex="-1"></a><span class="do">## add identifier</span></span>
<span id="cb93-26"><a href="model-sensitivity.html#cb93-26" aria-hidden="true" tabindex="-1"></a>out_2 <span class="ot">&lt;-</span> out_2 <span class="sc">%&gt;%</span></span>
<span id="cb93-27"><a href="model-sensitivity.html#cb93-27" aria-hidden="true" tabindex="-1"></a>   <span class="do">## make a new column</span></span>
<span id="cb93-28"><a href="model-sensitivity.html#cb93-28" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">ksGrazing =</span> <span class="fl">2.0</span>) <span class="co"># code as text</span></span>
<span id="cb93-29"><a href="model-sensitivity.html#cb93-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-30"><a href="model-sensitivity.html#cb93-30" aria-hidden="true" tabindex="-1"></a>out.all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(out_0<span class="fl">.5</span>, out_1, out_2)</span>
<span id="cb93-31"><a href="model-sensitivity.html#cb93-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-32"><a href="model-sensitivity.html#cb93-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-33"><a href="model-sensitivity.html#cb93-33" aria-hidden="true" tabindex="-1"></a>out.all <span class="sc">%&gt;%</span> </span>
<span id="cb93-34"><a href="model-sensitivity.html#cb93-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span>PHYTO<span class="sc">:</span>TotalN, <span class="at">names_to=</span><span class="st">&quot;State.var&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-35"><a href="model-sensitivity.html#cb93-35" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(time, value, <span class="at">colour=</span><span class="fu">as.factor</span>(ksGrazing))) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>State.var, <span class="at">scale=</span><span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="figs/unnamed-chunk-59-1.png" width="75%" /></p>
<p>Well, then… . Aren’t you glad you tried that!</p>
<div id="your-turn" class="section level3 hasAnchor" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Your turn<a href="model-sensitivity.html#your-turn" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Take a stab at varying something in your preferred model. You can use anyone’s data - we are all in this together. Just give proper attribution.</p>
<p>You can also come up with creative ways to quantify an output difference from a reference in an output. Often, we come up with a useful quantitative metric, run a larger number of scenarios (e.g., letting a parameter take 20 different values), and then plot the relation between the parameter and your quantitative measure of difference in output.</p>
<p>Be creative. See what you find.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="npzd---a-simple-aquatic-ecosystem.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="MEL.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
