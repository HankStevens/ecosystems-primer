<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Lake Metabolism | A Primer of Ecosystem Modeling</title>
  <meta name="description" content="This provides a part of foundation in understanding ecosystem models." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Lake Metabolism | A Primer of Ecosystem Modeling" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This provides a part of foundation in understanding ecosystem models." />
  <meta name="github-repo" content="HankStevens/ecosystems-primer" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Lake Metabolism | A Primer of Ecosystem Modeling" />
  
  <meta name="twitter:description" content="This provides a part of foundation in understanding ecosystem models." />
  

<meta name="author" content="Hank Stevens, BIO 672" />


<meta name="date" content="2021-01-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="N.html"/>
<link rel="next" href="MEL.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#a-couple-of-other-useful-citations"><i class="fa fa-check"></i><b>1.1</b> A couple of other useful citations</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction to ecosystem modeling</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#why-models"><i class="fa fa-check"></i><b>2.1</b> Why models?</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#whats-an-ecosystem"><i class="fa fa-check"></i><b>2.2</b> What’s an ecosystem?</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#whats-a-model"><i class="fa fa-check"></i><b>2.3</b> What’s a model?</a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#other-ideas"><i class="fa fa-check"></i><b>2.3.1</b> Other ideas</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#steps-in-modeling"><i class="fa fa-check"></i><b>2.4</b> Steps in modeling</a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#an-example-in-r"><i class="fa fa-check"></i><b>2.5</b> An example in R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="N.html"><a href="N.html"><i class="fa fa-check"></i><b>3</b> Describing a nitrogen budget</a><ul>
<li class="chapter" data-level="3.1" data-path="N.html"><a href="N.html#getting-started"><i class="fa fa-check"></i><b>3.1</b> Getting started</a></li>
<li class="chapter" data-level="3.2" data-path="N.html"><a href="N.html#first-mathematical-form-for-plant-uptake"><i class="fa fa-check"></i><b>3.2</b> First mathematical form for plant uptake</a></li>
<li class="chapter" data-level="3.3" data-path="N.html"><a href="N.html#paramaterization"><i class="fa fa-check"></i><b>3.3</b> Paramaterization</a></li>
<li class="chapter" data-level="3.4" data-path="N.html"><a href="N.html#mathematical-solution"><i class="fa fa-check"></i><b>3.4</b> Mathematical solution</a></li>
<li class="chapter" data-level="3.5" data-path="N.html"><a href="N.html#calibration-take-1"><i class="fa fa-check"></i><b>3.5</b> Calibration, take 1</a></li>
<li class="chapter" data-level="3.6" data-path="N.html"><a href="N.html#budget-take-ii"><i class="fa fa-check"></i><b>3.6</b> Budget, take II</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lake-metabolism.html"><a href="lake-metabolism.html"><i class="fa fa-check"></i><b>4</b> Lake Metabolism</a><ul>
<li class="chapter" data-level="4.1" data-path="lake-metabolism.html"><a href="lake-metabolism.html#estimating-productivity"><i class="fa fa-check"></i><b>4.1</b> Estimating Productivity</a></li>
<li class="chapter" data-level="4.2" data-path="lake-metabolism.html"><a href="lake-metabolism.html#by-hand-in-r"><i class="fa fa-check"></i><b>4.2</b> By hand, in R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="MEL.html"><a href="MEL.html"><i class="fa fa-check"></i><b>5</b> Multiple Element Limitation</a><ul>
<li class="chapter" data-level="5.1" data-path="MEL.html"><a href="MEL.html#rastetter-et-al.-1997"><i class="fa fa-check"></i><b>5.1</b> Rastetter et al. 1997</a></li>
<li class="chapter" data-level="5.2" data-path="MEL.html"><a href="MEL.html#implementing-mel"><i class="fa fa-check"></i><b>5.2</b> Implementing MEL</a><ul>
<li class="chapter" data-level="5.2.1" data-path="MEL.html"><a href="MEL.html#increasing-atmospheric-carbon-with-events-in-ode"><i class="fa fa-check"></i><b>5.2.1</b> Increasing atmospheric carbon with events in <code>ode()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>6</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Primer of Ecosystem Modeling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lake-metabolism" class="section level1">
<h1><span class="header-section-number">4</span> Lake Metabolism</h1>
<p>In this chapter, you’ll study how lakes breath. You’ll get real data from Acton Lake, look it, and measure the rate of an inhale and an exhale. You’ll do that by hand, by hand with a spreadsheet, by hand with R, and finally using an R package, <code>LakeMetabolizer</code>, which is designed to do that and much more.</p>
<div id="estimating-productivity" class="section level2">
<h2><span class="header-section-number">4.1</span> Estimating Productivity</h2>
<p>Most cells respire to do the work of growth and maintenance by consuming oxygen and using it as the final electron acceptor when O<span class="math inline">\(_2\)</span> is reduced, creating water. Because individuals comprise cells, and ecosystems comprise individuals, ecosystems respire too, and we can measure their metabolic rate using oxygen consumption and production.</p>
<p>We mesure ecosystem metabolic rate as net primary productivity which is the difference between gross primary productivity and respiration. Putting all of this in the same units of oxygen allows us to measure the rate,
<span class="math display">\[NPP = GPP - R\]</span>
If we assume that water column oxygen is correlated with the rates of photosynthesis, respiration, and net primary production, then we can think of the slopes of O vs. time as rates of respiration and net primary production. If we assume that respiration is constant throughout the 24 h cycle, we calculate GPP as the sum of NPP and R.</p>
</div>
<div id="by-hand-in-r" class="section level2">
<h2><span class="header-section-number">4.2</span> By hand, in R</h2>
<p>Let’s practice R by importing, wrangling, and graphing data, then calculating slopes and estimating respiration, NPP, and GPP.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="lake-metabolism.html#cb16-1"></a>acton &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/acton.csv&quot;</span>, </span>
<span id="cb16-2"><a href="lake-metabolism.html#cb16-2"></a>         <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">date_time =</span> </span>
<span id="cb16-3"><a href="lake-metabolism.html#cb16-3"></a>                            <span class="kw">col_datetime</span>(<span class="dt">format =</span> <span class="st">&quot;%m/%d/%y %H:%M&quot;</span>)), </span>
<span id="cb16-4"><a href="lake-metabolism.html#cb16-4"></a>    <span class="dt">skip =</span> <span class="dv">1</span><span class="co"># skips the first line of metadata</span></span>
<span id="cb16-5"><a href="lake-metabolism.html#cb16-5"></a>    )</span>
<span id="cb16-6"><a href="lake-metabolism.html#cb16-6"></a><span class="kw">summary</span>(acton)</span></code></pre></div>
<pre><code>##    date_time                       cum_h            O_mg.L      
##  Min.   :2013-06-27 06:15:00   Min.   :  0.00   Min.   : 4.530  
##  1st Qu.:2013-06-29 00:11:15   1st Qu.: 41.94   1st Qu.: 7.640  
##  Median :2013-06-30 18:07:30   Median : 83.88   Median : 8.365  
##  Mean   :2013-06-30 18:07:30   Mean   : 83.88   Mean   : 8.607  
##  3rd Qu.:2013-07-02 12:03:45   3rd Qu.:125.81   3rd Qu.: 9.582  
##  Max.   :2013-07-04 06:00:00   Max.   :167.75   Max.   :12.700  
##      O_perc           temp      
##  Min.   : 56.3   Min.   :24.60  
##  1st Qu.: 96.4   1st Qu.:25.00  
##  Median :107.6   Median :26.10  
##  Mean   :110.5   Mean   :26.12  
##  3rd Qu.:123.2   3rd Qu.:27.10  
##  Max.   :167.1   Max.   :28.10</code></pre>
<p>Let’s check our understanding of lake oxygen dynamics by plotting the time series. Ggplot understands what to do with dates.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="lake-metabolism.html#cb18-1"></a><span class="kw">ggplot</span>(acton, <span class="kw">aes</span>(<span class="dt">x=</span>date_time, <span class="dt">y=</span>O_mg.L)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_path</span>() </span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-13"></span>
<img src="figs/unnamed-chunk-13-1.png" alt="*Oxygen dynamics from Acton Lake." width="66%" />
<p class="caption">
Figure 4.1: *Oxygen dynamics from Acton Lake.
</p>
</div>
<p>If we want to calculate the slope of the night time oxygen concentration, then we should identify what the endpoints of “day time” are so that we can do analyses on just daylight or nighttime data.</p>
<p>Working with times is a little tricky, because times and dates, periods, durations, and intervals are inherently tricky. The <code>date_time</code> variable contains all the information, and we extra tidbits from it.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="lake-metabolism.html#cb19-1"></a><span class="co"># determine day/night intervals</span></span>
<span id="cb19-2"><a href="lake-metabolism.html#cb19-2"></a><span class="co">## Start of day</span></span>
<span id="cb19-3"><a href="lake-metabolism.html#cb19-3"></a>morning &lt;-<span class="st"> </span><span class="dv">7</span></span>
<span id="cb19-4"><a href="lake-metabolism.html#cb19-4"></a><span class="co">## end of day</span></span>
<span id="cb19-5"><a href="lake-metabolism.html#cb19-5"></a>evening &lt;-<span class="st"> </span><span class="dv">19</span></span>
<span id="cb19-6"><a href="lake-metabolism.html#cb19-6"></a></span>
<span id="cb19-7"><a href="lake-metabolism.html#cb19-7"></a>acton &lt;-<span class="st"> </span><span class="kw">mutate</span>(acton,</span>
<span id="cb19-8"><a href="lake-metabolism.html#cb19-8"></a>                <span class="dt">date =</span> <span class="kw">as.factor</span>( <span class="kw">format</span>(date_time, <span class="st">&quot;%Y-%m-%d&quot;</span>) ),</span>
<span id="cb19-9"><a href="lake-metabolism.html#cb19-9"></a>                <span class="co">## hour decimal format</span></span>
<span id="cb19-10"><a href="lake-metabolism.html#cb19-10"></a>                <span class="dt">hour.d =</span> <span class="kw">as.integer</span>( <span class="kw">format</span>(date_time, <span class="st">&quot;%H&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb19-11"><a href="lake-metabolism.html#cb19-11"></a><span class="st">                  </span><span class="kw">as.numeric</span>(<span class="kw">format</span>(date_time, <span class="st">&quot;%M&quot;</span>))<span class="op">/</span><span class="dv">60</span>,</span>
<span id="cb19-12"><a href="lake-metabolism.html#cb19-12"></a>                <span class="dt">day.d =</span> </span>
<span id="cb19-13"><a href="lake-metabolism.html#cb19-13"></a>                  <span class="kw">ifelse</span>(hour.d <span class="op">&gt;=</span><span class="st"> </span>morning <span class="op">&amp;</span><span class="st"> </span>hour.d <span class="op">&lt;</span><span class="st"> </span>evening, hour.d <span class="op">-</span><span class="st"> </span>morning, <span class="ot">NA</span>),</span>
<span id="cb19-14"><a href="lake-metabolism.html#cb19-14"></a>                <span class="dt">night.d =</span> </span>
<span id="cb19-15"><a href="lake-metabolism.html#cb19-15"></a>                  <span class="kw">ifelse</span>( hour.d <span class="op">&gt;=</span><span class="st"> </span>evening, hour.d<span class="op">-</span>evening, </span>
<span id="cb19-16"><a href="lake-metabolism.html#cb19-16"></a>                          <span class="kw">ifelse</span>(hour.d <span class="op">&lt;</span><span class="st"> </span>morning, </span>
<span id="cb19-17"><a href="lake-metabolism.html#cb19-17"></a>                                 <span class="dv">24</span> <span class="op">-</span><span class="st"> </span>evening <span class="op">+</span><span class="st"> </span>hour.d, <span class="ot">NA</span>)),</span>
<span id="cb19-18"><a href="lake-metabolism.html#cb19-18"></a>                <span class="dt">daylight =</span> <span class="kw">as.factor</span>(</span>
<span id="cb19-19"><a href="lake-metabolism.html#cb19-19"></a>                  <span class="kw">ifelse</span>(hour.d <span class="op">&gt;=</span><span class="st"> </span>morning <span class="op">&amp;</span><span class="st"> </span>hour.d <span class="op">&lt;</span><span class="st"> </span>evening, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;night&quot;</span>))</span>
<span id="cb19-20"><a href="lake-metabolism.html#cb19-20"></a>                )</span>
<span id="cb19-21"><a href="lake-metabolism.html#cb19-21"></a><span class="co">## with lubridate date(), hour(), minute()</span></span>
<span id="cb19-22"><a href="lake-metabolism.html#cb19-22"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb19-23"><a href="lake-metabolism.html#cb19-23"></a>acton &lt;-<span class="st"> </span><span class="kw">mutate</span>(acton,</span>
<span id="cb19-24"><a href="lake-metabolism.html#cb19-24"></a>                <span class="dt">date =</span> <span class="kw">as.factor</span>( <span class="kw">date</span>(date_time) ),</span>
<span id="cb19-25"><a href="lake-metabolism.html#cb19-25"></a>                <span class="co">## hour decimal format</span></span>
<span id="cb19-26"><a href="lake-metabolism.html#cb19-26"></a>                <span class="dt">hour.d =</span> <span class="kw">hour</span>(date_time) <span class="op">+</span><span class="st"> </span><span class="kw">minute</span>(date_time)<span class="op">/</span><span class="dv">60</span>,</span>
<span id="cb19-27"><a href="lake-metabolism.html#cb19-27"></a>                <span class="dt">day.d =</span> </span>
<span id="cb19-28"><a href="lake-metabolism.html#cb19-28"></a>                  <span class="kw">ifelse</span>(hour.d <span class="op">&gt;=</span><span class="st"> </span>morning <span class="op">&amp;</span><span class="st"> </span>hour.d <span class="op">&lt;</span><span class="st"> </span>evening, hour.d <span class="op">-</span><span class="st"> </span>morning, <span class="ot">NA</span>),</span>
<span id="cb19-29"><a href="lake-metabolism.html#cb19-29"></a>                <span class="dt">night.d =</span> </span>
<span id="cb19-30"><a href="lake-metabolism.html#cb19-30"></a>                  <span class="kw">ifelse</span>( hour.d <span class="op">&gt;=</span><span class="st"> </span>evening, hour.d<span class="op">-</span>evening, </span>
<span id="cb19-31"><a href="lake-metabolism.html#cb19-31"></a>                          <span class="kw">ifelse</span>(hour.d <span class="op">&lt;</span><span class="st"> </span>morning, </span>
<span id="cb19-32"><a href="lake-metabolism.html#cb19-32"></a>                                 <span class="dv">24</span> <span class="op">-</span><span class="st"> </span>evening <span class="op">+</span><span class="st"> </span>hour.d, <span class="ot">NA</span>)),</span>
<span id="cb19-33"><a href="lake-metabolism.html#cb19-33"></a>                <span class="dt">daylight =</span> <span class="kw">as.factor</span>(</span>
<span id="cb19-34"><a href="lake-metabolism.html#cb19-34"></a>                  <span class="kw">ifelse</span>(hour.d <span class="op">&gt;=</span><span class="st"> </span>morning <span class="op">&amp;</span><span class="st"> </span>hour.d <span class="op">&lt;</span><span class="st"> </span>evening, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;night&quot;</span>))</span>
<span id="cb19-35"><a href="lake-metabolism.html#cb19-35"></a>                )</span>
<span id="cb19-36"><a href="lake-metabolism.html#cb19-36"></a></span>
<span id="cb19-37"><a href="lake-metabolism.html#cb19-37"></a><span class="co"># check</span></span>
<span id="cb19-38"><a href="lake-metabolism.html#cb19-38"></a><span class="co"># filter(acton, hour.d==3) </span></span></code></pre></div>
<p>The slope of oxygen concentration at night is respiration.</p>
<p>Next we will pull out one day’s worth of data.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="lake-metabolism.html#cb20-1"></a>acton2 &lt;-<span class="st"> </span><span class="kw">subset</span>(acton,  date_time <span class="op">&gt;</span><span class="st"> &quot;2013-06-27 21:00:00&quot;</span> <span class="op">&amp;</span><span class="st"> </span>date_time <span class="op">&lt;</span><span class="st"> &quot;2013-06-28 06:15:00&quot;</span>) </span>
<span id="cb20-2"><a href="lake-metabolism.html#cb20-2"></a></span>
<span id="cb20-3"><a href="lake-metabolism.html#cb20-3"></a><span class="kw">qplot</span>(<span class="dt">x =</span> date_time, O_mg.L, <span class="dt">data=</span>acton2, <span class="dt">geom =</span> <span class="st">&quot;path&quot;</span>)</span></code></pre></div>
<p><img src="figs/unnamed-chunk-15-1.png" width="66%" /></p>
<p>Here is what each night looks like.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="lake-metabolism.html#cb21-1"></a>nights &lt;-<span class="st"> </span><span class="kw">filter</span>(acton, daylight<span class="op">==</span><span class="st">&quot;night&quot;</span>)</span>
<span id="cb21-2"><a href="lake-metabolism.html#cb21-2"></a><span class="kw">qplot</span>(night.d, O_mg.L, <span class="dt">data=</span>nights, <span class="dt">geom=</span><span class="st">&quot;point&quot;</span>, <span class="dt">colour=</span>date) <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="figs/unnamed-chunk-16-1.png" width="66%" /></p>
<p>We can calculate the average slope for all nights, forcing a straight line through each night’s data. The estimates of uncertainty and the P values won’t make sense because the data are horribly autocorrelated, but we can rely on the estimates of the coefficients, and the average slope, in particular.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="lake-metabolism.html#cb22-1"></a>m.resp &lt;-<span class="st"> </span><span class="kw">lm</span>(O_mg.L <span class="op">~</span><span class="st"> </span>night.d <span class="op">+</span><span class="st"> </span>date, <span class="dt">data=</span>acton)</span>
<span id="cb22-2"><a href="lake-metabolism.html#cb22-2"></a><span class="kw">summary</span>(m.resp)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = O_mg.L ~ night.d + date, data = acton)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.9649 -0.3722  0.0813  0.3683  2.1803 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    10.42500    0.17214  60.563  &lt; 2e-16 ***
## night.d        -0.17335    0.01291 -13.425  &lt; 2e-16 ***
## date2013-06-28 -0.51592    0.20392  -2.530   0.0119 *  
## date2013-06-29  0.14137    0.20392   0.693   0.4886    
## date2013-06-30 -0.86051    0.20392  -4.220 3.17e-05 ***
## date2013-07-01 -1.81634    0.20392  -8.907  &lt; 2e-16 ***
## date2013-07-02 -2.43509    0.20392 -11.941  &lt; 2e-16 ***
## date2013-07-03 -1.54342    0.20392  -7.569 3.87e-13 ***
## date2013-07-04  0.08223    0.23686   0.347   0.7287    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7955 on 327 degrees of freedom
##   (336 observations deleted due to missingness)
## Multiple R-squared:  0.6543, Adjusted R-squared:  0.6458 
## F-statistic: 77.36 on 8 and 327 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The estimate for <code>night.d</code>, <code>r round(coef(m.resp)[2],3)</code>, is our estimate of the respiration rate.</p>
<p>If you would like you could perform similar analyses on a subset of the data.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="lake-metabolism.html#cb24-1"></a>acton2 &lt;-<span class="st"> </span>acton <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(date <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2013-06-28&quot;</span>, <span class="st">&quot;2013-06-29&quot;</span>) )</span>
<span id="cb24-2"><a href="lake-metabolism.html#cb24-2"></a>m.resp2 &lt;-<span class="st"> </span><span class="kw">lm</span>(O_mg.L <span class="op">~</span><span class="st"> </span>night.d <span class="op">+</span><span class="st"> </span>date, <span class="dt">data=</span>acton2)</span>
<span id="cb24-3"><a href="lake-metabolism.html#cb24-3"></a><span class="kw">summary</span>(m.resp2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = O_mg.L ~ night.d + date, data = acton2)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.1718 -0.8263  0.1213  0.6559  1.5473 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    10.71318    0.18270  58.638  &lt; 2e-16 ***
## night.d        -0.31022    0.02389 -12.988  &lt; 2e-16 ***
## date2013-06-29  0.65729    0.16545   3.973  0.00014 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.8105 on 93 degrees of freedom
##   (96 observations deleted due to missingness)
## Multiple R-squared:  0.6648, Adjusted R-squared:  0.6576 
## F-statistic: 92.23 on 2 and 93 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="lake-metabolism.html#cb26-1"></a><span class="co"># install.packages(&quot;LakeMetabolizer&quot;, dep=TRUE)</span></span>
<span id="cb26-2"><a href="lake-metabolism.html#cb26-2"></a><span class="kw">library</span>(LakeMetabolizer)</span>
<span id="cb26-3"><a href="lake-metabolism.html#cb26-3"></a><span class="kw">names</span>(acton)</span>
<span id="cb26-4"><a href="lake-metabolism.html#cb26-4"></a>k.gas &lt;-<span class="st"> </span><span class="fl">0.4</span></span>
<span id="cb26-5"><a href="lake-metabolism.html#cb26-5"></a>z.mix &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb26-6"><a href="lake-metabolism.html#cb26-6"></a>irr </span>
<span id="cb26-7"><a href="lake-metabolism.html#cb26-7"></a>acton.LM &lt;-<span class="st"> </span>acton <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">z.mix =</span> z.mix, <span class="dt">k.gas =</span> k.gas ) <span class="op">%&gt;%</span></span>
<span id="cb26-8"><a href="lake-metabolism.html#cb26-8"></a><span class="st">  </span><span class="kw">select</span>(<span class="dt">datetime=</span>date_time, <span class="dt">do.obs=</span>O_mg.L, <span class="dt">do.sat=</span>O_perc, </span>
<span id="cb26-9"><a href="lake-metabolism.html#cb26-9"></a>         <span class="dt">k.gas=</span>k.gas, <span class="dt">z.mix=</span>z.mix )</span>
<span id="cb26-10"><a href="lake-metabolism.html#cb26-10"></a><span class="kw">str</span>(acton.LM)</span>
<span id="cb26-11"><a href="lake-metabolism.html#cb26-11"></a><span class="kw">summary</span>(acton.LM)</span>
<span id="cb26-12"><a href="lake-metabolism.html#cb26-12"></a><span class="kw">write.csv</span>(acton.LM, <span class="st">&quot;act.csv&quot;</span>, <span class="dt">row.names=</span><span class="ot">FALSE</span>)</span>
<span id="cb26-13"><a href="lake-metabolism.html#cb26-13"></a></span>
<span id="cb26-14"><a href="lake-metabolism.html#cb26-14"></a>acton.L &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;act.csv&quot;</span>, <span class="dt">colClasses=</span><span class="kw">c</span>(<span class="st">&quot;POSIXct&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;numeric&quot;</span>, <span class="dv">3</span>)))</span>
<span id="cb26-15"><a href="lake-metabolism.html#cb26-15"></a>n &lt;-<span class="st"> </span><span class="kw">nrow</span>(acton.L)</span>
<span id="cb26-16"><a href="lake-metabolism.html#cb26-16"></a>acton.LM &lt;-<span class="st"> </span>acton.L <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">k.gas =</span> k.gas, <span class="dt">z.mix =</span> <span class="dv">1</span>,  ) </span>
<span id="cb26-17"><a href="lake-metabolism.html#cb26-17"></a>irr &lt;-<span class="st"> </span>(<span class="dv">1500</span><span class="op">*</span><span class="kw">sin</span>(<span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span>(<span class="dv">1</span><span class="op">/</span>n )<span class="op">*</span>(<span class="dv">1</span><span class="op">:</span>(n<span class="op">*</span><span class="dv">2</span>))<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>pi) <span class="op">+</span><span class="st"> </span><span class="dv">650</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n<span class="op">*</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.25</span>)) <span class="op">*</span></span>
<span id="cb26-18"><a href="lake-metabolism.html#cb26-18"></a><span class="st">     </span><span class="kw">ifelse</span>(<span class="kw">is.day</span>(acton.L<span class="op">$</span>datetime, <span class="fl">39.5668</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb26-19"><a href="lake-metabolism.html#cb26-19"></a><span class="kw">plot</span>(irr)</span>
<span id="cb26-20"><a href="lake-metabolism.html#cb26-20"></a>acton.LM &lt;-<span class="st"> </span>acton.L <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">k.gas =</span> k.gas, <span class="dt">z.mix =</span> <span class="dv">1</span>,  <span class="dt">irr=</span>irr) </span>
<span id="cb26-21"><a href="lake-metabolism.html#cb26-21"></a><span class="kw">str</span>(acton.LM)</span>
<span id="cb26-22"><a href="lake-metabolism.html#cb26-22"></a>out &lt;-<span class="st"> </span><span class="kw">metab</span>(acton.LM, <span class="dt">method=</span><span class="st">&quot;bookkeep&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="N.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="MEL.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
