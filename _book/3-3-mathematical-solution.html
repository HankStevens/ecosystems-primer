<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="3.3 Mathematical solution | A Primer of Ecosystem Modeling" />
<meta property="og:type" content="book" />


<meta property="og:description" content="This provides a part of foundation in understanding ecosystem models." />
<meta name="github-repo" content="HankStevens/ecosystems-primer" />

<meta name="author" content="Hank Stevens, BIO 672" />

<meta name="date" content="2021-01-04" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="This provides a part of foundation in understanding ecosystem models.">

<title>3.3 Mathematical solution | A Primer of Ecosystem Modeling</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#prerequisites"><span class="toc-section-number">1</span> Prerequisites</a></li>
<li class="has-sub"><a href="2-intro.html#intro"><span class="toc-section-number">2</span> Introduction to ecosystem modeling</a><ul>
<li><a href="2-1-whats-a-model.html#whats-a-model"><span class="toc-section-number">2.1</span> What’s a model?</a></li>
<li><a href="2-2-some-useful-terminology.html#some-useful-terminology"><span class="toc-section-number">2.2</span> Some useful terminology</a></li>
<li><a href="2-3-model-making.html#model-making"><span class="toc-section-number">2.3</span> Model making</a></li>
</ul></li>
<li class="has-sub"><a href="3-describing-a-nitrogen-budget.html#describing-a-nitrogen-budget"><span class="toc-section-number">3</span> Describing a nitrogen budget</a><ul>
<li><a href="3-1-first-mathematical-form-for-plant-uptake.html#first-mathematical-form-for-plant-uptake"><span class="toc-section-number">3.1</span> First mathematical form for plant uptake</a></li>
<li><a href="3-2-paramaterization.html#paramaterization"><span class="toc-section-number">3.2</span> Paramaterization</a></li>
<li><a href="3-3-mathematical-solution.html#mathematical-solution"><span class="toc-section-number">3.3</span> Mathematical solution</a></li>
<li><a href="3-4-calibration-take-1.html#calibration-take-1"><span class="toc-section-number">3.4</span> Calibration, take 1</a></li>
<li><a href="3-5-budget-take-ii.html#budget-take-ii"><span class="toc-section-number">3.5</span> Budget, take II</a></li>
</ul></li>
<li><a href="4-references.html#references"><span class="toc-section-number">4</span> References</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="mathematical-solution" class="section level2">
<h2><span class="header-section-number">3.3</span> Mathematical solution</h2>
<p>The  is the process of making the
predictions using our model and our parameters. We  the
model. With simple models, we can sometimes find analytical
solutions. For most ecosystem models, we have to solve the models
numerically using .</p>
<p>Here we write a function that includes our system of differential
equations. This will allow R to integrate change through time.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="3-3-mathematical-solution.html#cb4-1"></a>bormann1 &lt;-<span class="st"> </span><span class="cf">function</span>(t, y, p) {</span>
<span id="cb4-2"><a href="3-3-mathematical-solution.html#cb4-2"></a>  <span class="co"># time, vector of state variables and parameters must be in this order</span></span>
<span id="cb4-3"><a href="3-3-mathematical-solution.html#cb4-3"></a>  <span class="co"># we can use as.list for both the state variables and parameters</span></span>
<span id="cb4-4"><a href="3-3-mathematical-solution.html#cb4-4"></a>  <span class="co"># a1 = uptake</span></span>
<span id="cb4-5"><a href="3-3-mathematical-solution.html#cb4-5"></a>  <span class="co"># a2 = loss from veg to avail</span></span>
<span id="cb4-6"><a href="3-3-mathematical-solution.html#cb4-6"></a>  <span class="co"># a3 = loss from veg to bound</span></span>
<span id="cb4-7"><a href="3-3-mathematical-solution.html#cb4-7"></a>  <span class="co"># a4 = net mineralization</span></span>
<span id="cb4-8"><a href="3-3-mathematical-solution.html#cb4-8"></a>  <span class="co"># a5 = export from avail</span></span>
<span id="cb4-9"><a href="3-3-mathematical-solution.html#cb4-9"></a>  <span class="co"># a6 = export from bound</span></span>
<span id="cb4-10"><a href="3-3-mathematical-solution.html#cb4-10"></a>  <span class="kw">with</span>( <span class="kw">as.list</span>( <span class="kw">c</span>(y, p) ), {</span>
<span id="cb4-11"><a href="3-3-mathematical-solution.html#cb4-11"></a>    dV.dt &lt;-<span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>A <span class="op">*</span><span class="st"> </span>V <span class="op">-</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>V <span class="op">-</span><span class="st"> </span>a3 <span class="op">*</span><span class="st"> </span>V</span>
<span id="cb4-12"><a href="3-3-mathematical-solution.html#cb4-12"></a>    dA.dt &lt;-<span class="st"> </span>i1 <span class="op">+</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>V <span class="op">+</span><span class="st"> </span>a4 <span class="op">*</span><span class="st"> </span>B <span class="op">-</span><span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>A <span class="op">*</span><span class="st"> </span>V <span class="op">-</span><span class="st"> </span>a5 <span class="op">*</span><span class="st"> </span>A </span>
<span id="cb4-13"><a href="3-3-mathematical-solution.html#cb4-13"></a>    dB.dt &lt;-<span class="st"> </span>i2 <span class="op">+</span><span class="st"> </span>a3 <span class="op">*</span><span class="st"> </span>V <span class="op">-</span><span class="st"> </span>a4 <span class="op">*</span><span class="st"> </span>B <span class="op">-</span><span class="st"> </span>a6 <span class="op">*</span><span class="st"> </span>B </span>
<span id="cb4-14"><a href="3-3-mathematical-solution.html#cb4-14"></a>    <span class="co"># Here we return a list whose first element is the vector of</span></span>
<span id="cb4-15"><a href="3-3-mathematical-solution.html#cb4-15"></a>    <span class="co"># rates of change for the state variables. The first element must be these rates,</span></span>
<span id="cb4-16"><a href="3-3-mathematical-solution.html#cb4-16"></a>    <span class="co"># in the same order as the state variables in y</span></span>
<span id="cb4-17"><a href="3-3-mathematical-solution.html#cb4-17"></a>    <span class="co"># The second element is the total N in the system</span></span>
<span id="cb4-18"><a href="3-3-mathematical-solution.html#cb4-18"></a>    <span class="kw">return</span>(<span class="kw">list</span>( <span class="kw">c</span>(dV.dt, dA.dt, dB.dt), </span>
<span id="cb4-19"><a href="3-3-mathematical-solution.html#cb4-19"></a>                 <span class="dt">total =</span> V <span class="op">+</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>B </span>
<span id="cb4-20"><a href="3-3-mathematical-solution.html#cb4-20"></a>                 )  )})</span>
<span id="cb4-21"><a href="3-3-mathematical-solution.html#cb4-21"></a>}</span></code></pre></div>
<p>Now that we have the function, we tell R what to do with it. We will define the , and then tell R which time point we want it to return.</p>
<p>The initial state of the system is the set of starting values for the state variables. We could choose any values, but I select the values given in Bormann et al. (1977).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="3-3-mathematical-solution.html#cb5-1"></a>initial.state &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="dt">V =</span> <span class="dv">532</span>, <span class="dt">A =</span> <span class="dv">26</span>, <span class="dt">B =</span> <span class="dv">4700</span>)</span></code></pre></div>
</div>
<p style="text-align: center;">
<a href="3-2-paramaterization.html"><button class="btn btn-default">Previous</button></a>
<a href="3-4-calibration-take-1.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
